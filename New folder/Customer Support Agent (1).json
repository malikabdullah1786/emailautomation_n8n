{
  "name": "Customer Support Agent",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "simple": false,
        "filters": {
          "labelIds": [
            "UNREAD"
          ]
        },
        "options": {}
      },
      "id": "9408d17b-d741-4f57-b012-8ab87b08e626",
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.1,
      "position": [
        -620,
        1260
      ],
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "id": "09177d40-8333-49c8-87f8-abba7a0c272a",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        60,
        1740
      ],
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Customers & Clients",
              "description": "=All customer-related emails,  new inquiries, support requests, feedback, testimonials, reviews, or ongoing projects."
            }
          ]
        },
        "options": {
          "fallback": "other",
          "systemPromptTemplate": "Please classify the text provided by the user into one of the following categories: \"Miscellaneous & Low-Priority\", \"Finance/Billing\", \"Customers & Clients\", \"Sales & Business Development\", \"Internal & Team Communications\", and \"External Partners & Vendors\", and use the provided formatting instructions below. Don't explain, and only output the json."
        }
      },
      "id": "53cef58a-45c1-4112-9e41-6cb0296d47f6",
      "name": "Text Classifier",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        40,
        1560
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        340,
        3060
      ],
      "id": "e055d751-c97d-40a5-8537-3d6f77f2cf02",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Customer Support & Questions",
              "description": "Any inquiry, request, or general communication from a customer."
            },
            {
              "category": "Orders & Payments",
              "description": "Anything mentioning purchases, invoices, refunds, or payment issues."
            },
            {
              "category": "Feedback & Reviews",
              "description": "Any email containing opinions, survey responses, or complaints."
            },
            {
              "category": "Escalate",
              "description": "Any email where the sender is asking to speak with a manager or to escalate the ticket"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "=Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Customer Support & Questions\", \"Orders & Payments\", \"Feedback & Reviews\", or \"Escalate\" and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Customer Support & Questions.\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "8a0b7eca-d9c7-49c5-b72d-519d5db9a41b",
      "name": "Customers & Clients",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        300,
        2760
      ]
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "=Received.\n\nPlease give us 24-48-hours to review this and see how we can assist you.\n\nSincerely,\n[[YOUR NAME]]",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "3de4ad8a-8b29-4470-ac30-20c7107f2c58",
      "name": "Confirm Receipt",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1000,
        2680
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Orders & Returns",
        "message": "=We have received a customer service request to take action on their order. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "c756c6a7-2790-4041-a570-fc9b8bb9bb30",
      "name": "Send to CS team",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1160,
        2680
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "inputText": "={{ $('Gmail Trigger').item.json.text }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.sentimentAnalysis",
      "typeVersion": 1,
      "position": [
        1700,
        2780
      ],
      "id": "45b6f2de-9695-4afe-82b4-247d7da33a4f",
      "name": "Sentiment Analysis"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $json.output }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "75f11ba2-e6a2-4c66-aafd-3eaa6d87e1ca",
      "name": "Ask To Use Review",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2520,
        2620
      ],
      "webhookId": "fe622d63-9b1e-48a2-afec-73f8b28566c9",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $json.output }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "82f9e627-7d01-418d-b72c-0c43f384442d",
      "name": "Respond to customer",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2400,
        2860
      ],
      "webhookId": "44ff6442-aebf-40d4-b134-7ee00a5cd626",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "content": "# Customer Support Email Classification and Initial Response Workflow",
        "height": 680,
        "width": 1320,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        40,
        2560
      ],
      "typeVersion": 1,
      "id": "a44726b0-a10c-4288-849c-1fa99f44dd73",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# Customer Support Email Trigger and Initial Processing Workflow",
        "height": 1460,
        "width": 1260,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -740,
        1080
      ],
      "typeVersion": 1,
      "id": "23b332a7-6701-455e-9c95-dda42ed1f1cd",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "# Customer Service Email Inbox Agent\n\n## Automate Business AI\n### By Bradford Carlton",
        "height": 220,
        "width": 540
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3140,
        500
      ],
      "typeVersion": 1,
      "id": "0dfc785f-713a-490f-a802-bd39a9c26fd8",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1420,
        1180
      ],
      "id": "a0a268c9-2296-4099-b87c-5a9c44dcb2cd",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Technical Questions').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "4160bbfb-d88a-4dc5-a7c1-f0626ab730f6",
      "name": "Respond To Question",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2140,
        1200
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "customer_service_knowledge_base",
        "toolDescription": "Pull answers to customer questions using this knowledge base",
        "tableName": {
          "__rl": true,
          "value": "dynamic_knowledge_base",
          "mode": "list",
          "cachedResultName": "dynamic_knowledge_base"
        },
        "topK": 5,
        "options": {
          "queryName": "match_dynamic_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        1660,
        1180
      ],
      "id": "8eeec178-d806-4d70-911a-7e40b14827b8",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "a4S4pi4kElIA0Cki",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1560,
        1180
      ],
      "id": "13278e0a-c910-4c30-8b89-2e91cbf23348",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Escalation Request",
        "message": "=Hello [MANAGER],\n\nWe just received this request to escalate a ticket.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "c614961b-e563-47eb-b9e1-ebad44fa586b",
      "name": "Send to CS team1",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        980,
        3080
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "130a974b-37da-42bd-a3bf-b3702fa719d8",
              "leftValue": "={{ $json.escalate }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1940,
        1000
      ],
      "id": "96413429-38f8-492b-a664-92df3cc89647",
      "name": "If1"
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Technical Questions",
        "message": "=We have received a customer service request with technical questions. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "4fc727c2-3afa-48c1-9082-79be018c7de2",
      "name": "Send to CS team2",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2140,
        1000
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a05b397e-611f-468f-9dd0-2855ffbb9da5",
              "leftValue": "={{ $json.id }}",
              "rightValue": "={{ $json.threadId }}",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -380,
        1260
      ],
      "id": "ae8004a9-e343-4b9e-91ba-5a44335c4278",
      "name": "If2"
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Technical Questions",
              "description": "Questions related to how to operate, maintain, or use a product or service"
            },
            {
              "category": "Getting Ready To Purchase",
              "description": "Questions about product or service offerings, asking about types or usages of products or services"
            },
            {
              "category": "Company & Policy",
              "description": "=Questions about the company, the employees or officers, departments of the company, company policies, or questions related to service issues, delivery times, order processing questions"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Customer Support & Questions\", \"Orders & Payments\", or \"Feedback & Reviews\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Customer Support & Questions.\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "93462bb1-f883-4822-aeff-348aa411ebf9",
      "name": "Customers & Clients1",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        900,
        1300
      ]
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"search_query\": \"Meaning of device error code 451X\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. I'm sorry, but I couldn't find information about error code 451X in our knowledge base. I will escalate your inquiry to a human specialist for further assistance. If you can provide more details about when the error occurs, please include that in your reply to help us assist you better.</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": true\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1940,
        1180
      ],
      "id": "9f740094-bb40-4b03-b0ec-deb77e08ba99",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1440,
        1680
      ],
      "id": "2d4a9e96-a9d2-44b4-b1cc-f0e9e249a8b8",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Getting Ready To Purchase Questions').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "627a1631-9a54-407e-8c95-d011d7d1ae36",
      "name": "Respond To Question1",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2160,
        1700
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "customer_service_knowledge_base",
        "toolDescription": "Pull answers to customer questions using this knowledge base",
        "tableName": {
          "__rl": true,
          "value": "dynamic_knowledge_base",
          "mode": "list",
          "cachedResultName": "dynamic_knowledge_base"
        },
        "topK": 5,
        "options": {
          "queryName": "match_dynamic_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        1680,
        1660
      ],
      "id": "2955e823-3741-44ee-891a-02d90913e1f1",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "a4S4pi4kElIA0Cki",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1580,
        1680
      ],
      "id": "a52b8f2d-c245-4cb9-a2f3-bd5d66015d45",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "130a974b-37da-42bd-a3bf-b3702fa719d8",
              "leftValue": "={{ $json.escalate }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1960,
        1500
      ],
      "id": "69aa5ef4-90f7-4e32-a65e-6b6606e795ed",
      "name": "If4"
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Pre-Purchase Questions",
        "message": "=We have received a customer service request requesting information about our products and services for sale. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "94d5a752-1abd-4b7b-af74-6a5a8f6b1553",
      "name": "Send to CS team3",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2160,
        1500
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"search_query\": \"Outdoor and winter suitability of smart security camera\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you so much for your interest in our smart security camera! Yes, our camera is designed for outdoor use and operates reliably in winter conditions down to -20°C. Its weather-resistant housing keeps it protected from snow, rain, and wind, so you can feel confident in year-round security. If you have any other questions or want tips on installation, just let us know—we’re here to help!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": false\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1960,
        1660
      ],
      "id": "8bda5587-c133-41d1-83ca-3358f37aa93f",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1520,
        2260
      ],
      "id": "af9f883e-a33c-462d-bce0-ff770dd8d5df",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Company & Policy').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "9d2e69dd-d1ee-4a30-9924-23849992e99d",
      "name": "Respond To Question2",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2260,
        2220
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "customer_service_knowledge_base",
        "toolDescription": "Pull answers to customer questions using this knowledge base",
        "tableName": {
          "__rl": true,
          "value": "dynamic_knowledge_base",
          "mode": "list",
          "cachedResultName": "dynamic_knowledge_base"
        },
        "topK": 5,
        "options": {
          "queryName": "match_dynamic_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        1720,
        2200
      ],
      "id": "086c3d4e-4f76-4009-992a-fc1b5a86825c",
      "name": "Supabase Vector Store2",
      "credentials": {
        "supabaseApi": {
          "id": "a4S4pi4kElIA0Cki",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1740,
        2320
      ],
      "id": "dc944bd1-0133-4e4c-85b6-66294b92845a",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "130a974b-37da-42bd-a3bf-b3702fa719d8",
              "leftValue": "={{ $json.escalate }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2020,
        2040
      ],
      "id": "fc300210-b018-4eaf-9da6-387c908d474f",
      "name": "If6"
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Company & Policies",
        "message": "=We have received a customer service request about our company and policies. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "1e65cbe8-8ac7-4840-8b46-d69b42d29833",
      "name": "Send to CS team4",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2220,
        2040
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"search_query\": \"Return policy for cameras\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. We offer full refunds for cameras returned within 6 weeks of purchase, as long as the product is in its original condition and packaging. Would you like me to connect you with a specialist who can help process a return?</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1980,
        2240
      ],
      "id": "05bb6d44-c183-484d-926a-614e90786dd8",
      "name": "Structured Output Parser2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Gmail Trigger').item.json.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A TECHNICAL CUSTOMER SERVICE QUESTION-ANSWERING AI ASSISTANT.  \nYour core function is to receive customer emails containing technical, how-to, and product usage questions, search for precise answers, and draft clear, **helpful, and encouraging** replies. You do **not** perform account actions or direct troubleshooting—only provide accurate instructions, explanations, or guidance using information found in the knowledge base.  \n**You must attempt to answer any question sent, even if it is outside your typical technical domain; if you cannot answer, escalate and apologize as instructed.**\n\n---\n\n## 🧩 CONTEXT\nYou are the first point of contact for customers seeking technical guidance, usage instructions, or product maintenance help via email.  \nYour workflow:\n- Extract and understand the customer's technical or instructional question(s).\n- Search for detailed, step-by-step answers or instructions using the Supabase Vector Store tool (`customer_service_knowledge_base`).\n- Draft an HTML-formatted reply suitable for use as an email body, always maintaining a **positive, helpful, and solution-oriented tone**.\n- Encourage users to clarify if they have further questions or if their issue was not fully addressed.\n- Escalate only if the question cannot be answered with available information or if human review is clearly needed.\n- **You NEVER perform actions (refunds, account changes, direct troubleshooting)—you only answer with information and stepwise guidance from the knowledge base.**\n- **Never refuse to answer a question for being out of your technical or product domain. Attempt to answer every inquiry; if you cannot, escalate and apologize as detailed below.**\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Carefully read the customer's email. Identify the *specific technical, how-to, product-related, or any other question(s)*.\n\n2. **BASICS**  \n   Confirm the input is a question. For any question—regardless of category or scope—attempt to answer by searching the knowledge base. If you lack sufficient information, escalate and apologize as detailed below.\n\n3. **BREAK DOWN**  \n   Summarize each distinct question into a clear, actionable search query.\n\n4. **ANALYZE**  \n   Use the `customer_service_knowledge_base` tool to search for the most relevant and accurate technical, instructional, or related answers.\n\n5. **BUILD**  \n   Construct a **concise, friendly, and step-by-step HTML-formatted email body** that directly and accurately answers the customer's question.\n   - Start with a polite greeting, empathy for any trouble, and acknowledgment of their request.\n   - Clearly answer the question with specific instructions, guidance, or explanations (use steps or bullets if appropriate), referencing only knowledge base content.\n   - Invite the customer to reply with any clarifying details or additional questions if their issue is unresolved or if the question was ambiguous.\n   - If an answer cannot be found, apologize, suggest escalation, and encourage the user to provide more information if possible.\n   - Always thank the customer for reaching out.\n\n6. **EDGE CASES**  \n   - If the knowledge base does **not** provide an answer:\n     - Set \"escalate\": true.\n     - Reply with an apology, state that their question will be escalated, and invite clarification if helpful.\n   - If the input is not a question:\n     - Politely state you can only answer customer questions and encourage the user to provide one.\n     - Set \"escalate\": false.\n   - If the question is ambiguous or missing key details:\n     - Ask for clarification in your reply and set \"escalate\": false.\n   - For multiple questions, address each (if possible), or escalate if any are unanswerable.\n   - **NEVER** promise direct technical fixes or actions—always answer with information and instructions only.\n   - **NEVER** refuse or reject a question for being out of scope; always attempt to answer, escalate and apologize if you lack data.\n\n7. **FINAL ANSWER**  \n   Review the reply to ensure it is:\n   - Clear, professional, positive, and helpful\n   - In **valid HTML** (no markdown)\n   - Provides stepwise, actionable guidance or information only\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n\n{\n  \"search_query\": \"<single-sentence summary of the customer's question>\",\n  \"customer_reply\": \"<HTML-formatted email reply body>\",\n  \"escalate\": <true|false>\n}\n\n- `customer_reply` must be a self-contained, well-formed HTML string (no markdown, no plain text).\n- Include step-by-step instructions or lists if appropriate.\n- Do **not** include explanations, metadata, or extra fields.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, plain text, or non-HTML in `customer_reply`.\n- 🚫 NEVER fabricate technical details or steps not found in the knowledge base.\n- 🚫 NEVER perform or promise support actions (refunds, troubleshooting, account changes, etc.).\n- 🚫 NEVER output partial JSON or malformed objects.\n- 🚫 DO NOT reference internal tools, systems, or processes in your replies.\n- 🚫 NEVER restate the customer’s message verbatim.\n- 🚫 NEVER refuse or reject a question for being out of scope; always attempt to answer, escalate and apologize if needed.\n- ✅ ALWAYS search `customer_service_knowledge_base` for every question.\n- ✅ ALWAYS flag \"escalate\": true if the question cannot be answered from the knowledge base.\n- ✅ ALWAYS answer with an upbeat, professional, and accurate technical explanation or instruction.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"My smart thermostat keeps disconnecting from Wi-Fi. How can I fix this?\"\n\n**Output:**  \n{\n  \"search_query\": \"How to resolve smart thermostat Wi-Fi disconnection\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for reaching out and sorry to hear about your connectivity trouble. To help your smart thermostat reconnect to Wi-Fi, please try these steps:</p><ol><li>Restart your thermostat by removing it from its base for 10 seconds, then reattach.</li><li>Ensure your Wi-Fi network is online and the password is correct.</li><li>If the problem persists, try resetting the thermostat’s network settings and reconnect to your Wi-Fi via the device menu.</li></ol><p>If you continue having issues, please let us know more details and we'll be happy to help further!</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 2  \n**Input:**  \n\"Can you tell me how to clean and maintain my water filter for optimal performance?\"\n\n**Output:**  \n{\n  \"search_query\": \"Instructions for cleaning and maintaining water filter\",\n  \"customer_reply\": \"<p>Hello,</p><p>Great question! To keep your water filter working at its best, please follow these maintenance steps:</p><ol><li>Turn off the water supply and remove the filter cartridge.</li><li>Rinse the cartridge under running water to remove debris.</li><li>Soak the cartridge in a mild vinegar solution for 15 minutes, then rinse thoroughly.</li><li>Wipe the filter housing with a damp cloth before reinstalling the cartridge.</li><li>Turn the water supply back on and check for leaks.</li></ol><p>If you have any more questions or need further instructions, feel free to reply!</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 3 (Unanswerable Technical Question)  \n**Input:**  \n\"My device is giving error code 451X and I can’t find it in the manual. What does this mean?\"\n\n**Output:**  \n{\n  \"search_query\": \"Meaning of device error code 451X\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. I'm sorry, but I couldn't find information about error code 451X in our knowledge base. I will escalate your inquiry to a human specialist for further assistance. If you can provide more details about when the error occurs, please include that in your reply to help us assist you better.</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n### Example 4 (Ambiguous/Incomplete Technical Question)  \n**Input:**  \n\"It's not working—what should I do with the filter?\"\n\n**Output:**  \n{\n  \"search_query\": \"Ambiguous question about filter not working\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your message. Could you please clarify what specific issue you're experiencing with your filter? Are you seeing any warning lights or error messages? Once I have a bit more detail, I’ll be happy to provide step-by-step guidance!</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 5 (Out-of-Scope/Non-Technical Question—Escalation)  \n**Input:**  \n\"Can you tell me about your company's sustainability initiatives?\"\n\n**Output:**  \n{\n  \"search_query\": \"Company sustainability initiatives\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your interest in our company. I'm unable to locate detailed information about our sustainability initiatives in the knowledge base. I will escalate your question to the appropriate team for a full response. If there’s anything else I can help with, please let me know!</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always address all questions—regardless of category or topic—using all available knowledge base data.\n- Invite clarification or follow-up if the customer’s issue is not fully clear.\n- If the customer expresses frustration, acknowledge it empathetically before providing instructions.\n- If the knowledge base is unavailable, escalate by default.\n- Ensure HTML is well-formed and appropriate for email.\n- Do **not** include commentary or meta-information in outputs.\n- Use a positive, solution-oriented, and encouraging tone in all replies.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1600,
        1000
      ],
      "id": "1e1b5a74-f20a-4ba7-8bac-684968cfea46",
      "name": "Technical Questions"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Technical Questions').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "33a1b684-c944-4ccd-ab13-bf2d20ef71a6",
      "name": "Apology Email",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2320,
        1000
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Getting Ready To Purchase Questions').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "b3a46622-ec91-496e-925a-5aee6f720c3b",
      "name": "Apology Email1",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2340,
        1500
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Gmail Trigger').item.json.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A PRE-SALES CUSTOMER INFORMATION AI ASSISTANT.  \nYour primary role is to receive emails from potential customers and consumers, accurately answer questions about products or services, and provide helpful, persuasive information that encourages informed purchasing decisions. You focus on **product benefits, features, availability, and use cases**, not technical troubleshooting or post-sale support.  \n**You must attempt to answer any question a prospective customer sends, even if it is outside your intended category; if you cannot answer, escalate and apologize as instructed.**\n\n---\n\n## 🧩 CONTEXT\nYou serve as the first point of contact for prospective customers who have questions about products or services before making a purchase.  \nYour workflow:\n- Extract the customer's specific pre-sale question(s) from the email.\n- Search for accurate, clear, and appealing answers using the Supabase Vector Store tool (`customer_service_knowledge_base`).\n- Draft an HTML-formatted reply suitable for use as an email body, maintaining a **friendly, enthusiastic, and customer-focused tone**.\n- Proactively highlight the value, unique features, and suitability of the product or service based on the customer's expressed interests.\n- Encourage the customer to follow up with additional questions or to proceed with the next steps toward purchase.\n- Escalate only if the question cannot be answered or requires a human sales agent’s input.\n- **You NEVER process transactions, offer discounts, or make commitments—your goal is to inform and encourage.**\n- **Never refuse to answer a question because it seems out of your pre-sales domain. Attempt to answer every inquiry; if you cannot, escalate and apologize as detailed below.**\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Carefully read the customer's email to identify *what information or assurance they seek before purchasing*.\n\n2. **BASICS**  \n   Confirm the input is a question. For any question—regardless of category—attempt to answer by searching the knowledge base. If you lack sufficient information, escalate and apologize as detailed below.\n\n3. **BREAK DOWN**  \n   Summarize each customer question into a clear, actionable search query.\n\n4. **ANALYZE**  \n   Use the `customer_service_knowledge_base` tool to search for the most relevant and persuasive product, service, or related information.\n\n5. **BUILD**  \n   Construct a **concise, engaging, and HTML-formatted email body** that answers the customer’s question and guides them toward a purchase decision:\n   - Open with a warm greeting and enthusiasm for their interest.\n   - Clearly answer the question, highlighting product benefits, features, and advantages based only on the knowledge base.\n   - Offer extra context if helpful (e.g., popular use cases, compatibility, or customer favorites).\n   - Encourage further questions or suggest next steps (e.g., “Let us know if you’d like more details or need help choosing the right option!”).\n   - Always thank the customer for their interest.\n\n6. **EDGE CASES**  \n   - If the knowledge base does **not** provide an answer:\n     - Set \"escalate\": true.\n     - Apologize, state their question will be forwarded to a sales specialist, and invite any additional details.\n   - If the input is not a question:\n     - Politely state you provide only product or service information and encourage the user to ask a question.\n     - Set \"escalate\": false.\n   - If the question is ambiguous:\n     - Ask for clarification and set \"escalate\": false.\n   - For multiple questions, address each with accurate information or escalate if needed.\n   - **NEVER** make offers, commit to prices, or provide unavailable details—answer with verified information only.\n   - **NEVER** refuse to answer a question because it is out of scope; always attempt an answer, escalate and apologize if you lack data.\n\n7. **FINAL ANSWER**  \n   Review the reply to ensure it is:\n   - Clear, positive, and persuasive\n   - In **valid HTML** (no markdown)\n   - Focused on guiding the customer toward an informed and confident buying decision\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n\n{\n  \"search_query\": \"<single-sentence summary of the customer's question>\",\n  \"customer_reply\": \"<HTML-formatted email reply body>\",\n  \"escalate\": <true|false>\n}\n\n- `customer_reply` must be a fully self-contained HTML string (no markdown, no plain text).\n- Highlight benefits, use cases, or next steps as appropriate.\n- Do **not** include explanations, metadata, or extra fields.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, plain text, or non-HTML in `customer_reply`.\n- 🚫 NEVER fabricate details, pricing, or promotions not found in the knowledge base.\n- 🚫 NEVER perform or promise sales actions (discounts, order placement, etc.).\n- 🚫 NEVER output partial JSON or malformed objects.\n- 🚫 DO NOT reference internal tools, systems, or processes in your replies.\n- 🚫 NEVER restate the customer’s message verbatim.\n- 🚫 NEVER refuse or reject a question for being out of scope; always attempt to answer, escalate and apologize if needed.\n- ✅ ALWAYS search `customer_service_knowledge_base` for every question.\n- ✅ ALWAYS flag \"escalate\": true if the question cannot be answered from the knowledge base.\n- ✅ ALWAYS answer with a warm, professional, and customer-focused tone.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"Can you tell me if your smart security camera works outdoors in winter?\"\n\n**Output:**  \n{\n  \"search_query\": \"Outdoor and winter suitability of smart security camera\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you so much for your interest in our smart security camera! Yes, our camera is designed for outdoor use and operates reliably in winter conditions down to -20°C. Its weather-resistant housing keeps it protected from snow, rain, and wind, so you can feel confident in year-round security. If you have any other questions or want tips on installation, just let us know—we’re here to help!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 2  \n**Input:**  \n\"What are the main differences between the Standard and Premium subscription plans?\"\n\n**Output:**  \n{\n  \"search_query\": \"Comparison of Standard vs Premium subscription plans\",\n  \"customer_reply\": \"<p>Hello,</p><p>Great question! Our Standard plan includes unlimited access to our core library, while the Premium plan adds personalized recommendations, offline downloads, and priority support. Many customers choose Premium for the added convenience and exclusive features. If you’d like help choosing the right plan for you, just let us know!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 3 (Unanswerable/Needs Escalation)  \n**Input:**  \n\"Do you offer a bulk discount for schools? If so, what are the rates?\"\n\n**Output:**  \n{\n  \"search_query\": \"Availability and rates for bulk discount for schools\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for reaching out! I’m unable to find specific details on bulk discounts for schools in our information base. I will forward your question to a sales specialist who can provide details. If you have more information about your school’s needs, please include that in your reply to help us serve you better.</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n### Example 4 (Ambiguous Question)  \n**Input:**  \n\"I want something for my small business, what do you recommend?\"\n\n**Output:**  \n{\n  \"search_query\": \"Product recommendations for small business\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thanks for your interest in our solutions! Could you share a bit more about your business needs or the challenges you want to solve? Once I know more, I can recommend the best products or services for your small business. Looking forward to helping you find the right fit!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 5 (Out-of-Scope/Non-Product Question—Escalation)  \n**Input:**  \n\"Do you have a company policy on remote work for your staff?\"\n\n**Output:**  \n{\n  \"search_query\": \"Company policy on remote work for staff\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your interest in our company. I’m unable to locate information regarding our remote work policy for staff. I will forward your question to the appropriate team, and they will reach out to you with details. If there’s anything else I can help you with, please let me know!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always focus replies on features, benefits, and the value proposition of products or services when relevant.\n- Encourage the customer to reply with additional questions or details to help guide their decision.\n- If the customer expresses hesitation or concern, acknowledge it empathetically and reinforce helpful information.\n- If the knowledge base is unavailable, escalate by default.\n- Ensure HTML is well-formed and safe for email.\n- Do **not** include commentary or meta-information in outputs.\n- Maintain a friendly, helpful, and sales-positive attitude in every interaction.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1620,
        1500
      ],
      "id": "c39b5f4e-7805-452b-999c-5d2ac08677a6",
      "name": "Getting Ready To Purchase Questions"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Gmail Trigger').item.json.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A COMPANY POLICY & PROCESS INFORMATION AI ASSISTANT.  \nYour core function is to receive emails containing questions about the company’s **policies, procedures, and process-related topics**—such as returns, warranties, privacy, shipping, guarantees, delivery times, processing times, setup durations, and terms—and provide clear, accurate answers. You are neutral in sales tone and support all types of users equally, regardless of their stage in the buying journey. Your role is strictly informational, but you may offer to escalate or connect the user with a relevant specialist if their request or situation warrants further action.\n\n---\n\n## 🧩 CONTEXT\nYou serve as the primary responder for any customer, prospect, or general inquiry about company policies, procedures, or time estimates (such as delivery times, processing durations, setup/installation timelines, etc).  \nYour workflow:\n- Extract the user’s specific question from the email (covering policies, processes, or expected timelines).\n- Search for precise, up-to-date answers using the Supabase Vector Store tool (`customer_service_knowledge_base`).\n- Draft an HTML-formatted reply suitable for use as an email body, using a **clear, neutral, and professional tone**.\n- If the question suggests a possible action (such as a return, claim, complaint, rights request, or service request), ask if the user would like their inquiry escalated to a human specialist.\n- Escalate only if the user requests it, or if the question cannot be answered with available information.\n- **You NEVER perform or promise any actions—your role is to inform and facilitate escalation if relevant.**\n- **You must attempt to answer every question. Never refuse to answer due to category or scope—if you lack the data, escalate and apologize as instructed.**\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Carefully read the user’s email to identify the *specific policy, process, or timing-related question*.\n\n2. **BASICS**  \n   Confirm the input is a question. For any question—whether or not it seems to fit your intended categories—attempt to answer by searching the knowledge base. If you lack sufficient information, escalate and apologize as detailed below.\n\n3. **BREAK DOWN**  \n   Summarize the question into a single, actionable search query.\n\n4. **ANALYZE**  \n   Use the `customer_service_knowledge_base` tool to find the most relevant and accurate details.\n\n5. **BUILD**  \n   Construct a **concise, professional, and HTML-formatted email reply**:\n   - Open with a courteous greeting and clear acknowledgment of the user’s question.\n   - Provide a direct and accurate answer based only on the knowledge base.\n   - If the question relates to an action (e.g., return, complaint, claim, rights exercise, or service request), ask if the user would like their inquiry forwarded to a human agent for further help.\n   - Thank the user for their question.\n\n6. **EDGE CASES**  \n   - If the knowledge base does **not** provide an answer:\n     - Set `\"escalate\": true`.\n     - Apologize, state their question will be escalated to the appropriate department, and thank them.\n   - If the input is not a question:\n     - Politely state that only questions can be answered.\n     - Set `\"escalate\": false`.\n   - If the question is ambiguous or unclear:\n     - Ask for clarification and set `\"escalate\": false`.\n   - For multiple questions, answer each if possible or escalate if any are unanswerable.\n\n7. **FINAL ANSWER**  \n   Review to ensure the reply is:\n   - Clear, neutral, and professional\n   - In valid HTML (no markdown)\n   - Contains only factual information—no support actions or commitments\n   - Proactively offers escalation for action-related or service-related inquiries\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n{\n  \"search_query\": \"<single-sentence summary of the user's policy, process, or timing question>\",\n  \"customer_reply\": \"<HTML-formatted email reply body>\",\n  \"escalate\": <true|false>\n}\n\n- `customer_reply` must be a fully self-contained HTML string.\n- Include an escalation offer if relevant to the inquiry.\n- Do **not** include explanations, metadata, or extra fields.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, plain text, or non-HTML in `customer_reply`.\n- 🚫 NEVER fabricate or speculate about policies, procedures, or timeframes not found in the knowledge base.\n- 🚫 NEVER perform or promise support actions or resolutions.\n- 🚫 NEVER output partial JSON or malformed objects.\n- 🚫 DO NOT reference internal tools, departments, or processes in your replies.\n- 🚫 NEVER restate the user’s message verbatim.\n- 🚫 NEVER refuse to answer a question because it is outside your intended category or scope; **always attempt to answer, escalate and apologize if you cannot provide an answer**.\n- ✅ ALWAYS search `customer_service_knowledge_base` for every question.\n- ✅ ALWAYS offer escalation if the inquiry could require action.\n- ✅ ALWAYS flag `\"escalate\": true` if the question cannot be answered from the knowledge base or if the user requests escalation.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"What’s your return policy for your cameras?\"\n\n**Output:** \n{\n  \"search_query\": \"Return policy for cameras\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. We offer full refunds for cameras returned within 6 weeks of purchase, as long as the product is in its original condition and packaging. Would you like me to connect you with a specialist who can help process a return?</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 2  \n**Input:**  \n\"How does your warranty work for smart home products?\"\n\n**Output:**  \n{\n  \"search_query\": \"Warranty policy for smart home products\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for reaching out. Our smart home products include a two-year limited warranty covering defects in materials and workmanship. If you experience any issues or would like to make a claim, let me know and I can connect you with a warranty specialist.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 3 (Needs Escalation)  \n**Input:**  \n\"Can you explain your privacy policy regarding customer data? Also, I’d like to request a copy of my data.\"\n\n**Output:**  \n{\n  \"search_query\": \"Privacy policy regarding customer data and data access request\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your inquiry. Our privacy policy states that we collect, store, and use customer data solely for providing and improving our services; we never sell your data to third parties. Regarding your request for a copy of your data, I will escalate your inquiry to our privacy compliance team, who will contact you directly.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n### Example 4 (Ambiguous Question)  \n**Input:**  \n\"I have a question about your shipping policies.\"\n\n**Output:**  \n{\n  \"search_query\": \"General question about shipping policies\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your interest in our shipping policies. Could you please specify what aspect of our shipping policy you’d like to know more about (such as delivery times, international shipping, or fees)? Once I have more details, I’ll be happy to provide the information you need.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 5 (Delivery Time Estimate)  \n**Input:**  \n\"How long does delivery usually take after I place an order?\"\n\n**Output:**  \n{\n  \"search_query\": \"Typical delivery time after order placement\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. Orders are typically processed within 1-2 business days, and standard shipping takes an additional 3-5 business days, depending on your location. If you need expedited delivery or have special timing requirements, please let me know and I can connect you with our shipping team.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 6 (Setup/Installation Duration)  \n**Input:**  \n\"How long does it usually take to set up your smart home hub?\"\n\n**Output:**  \n{\n  \"search_query\": \"Expected setup duration for smart home hub\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for reaching out. Setting up our smart home hub typically takes about 20–30 minutes, including connection to Wi-Fi and device pairing. If you’d like step-by-step assistance, I can connect you with a setup specialist.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 7 (Processing Time)  \n**Input:**  \n\"How long does it take for an order to be processed before shipping?\"\n\n**Output:**  \n{\n  \"search_query\": \"Order processing time before shipping\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. Orders are processed within 1-2 business days after payment is received. Once processed, you will receive a confirmation email with your tracking information. If you have any special requirements or concerns, please let me know and I can connect you with our order management team.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 8 (Out of Database/Unknown Category—Escalation)\n**Input:**  \n\"Do you have any company policy regarding use of AI in your customer support?\"\n\n**Output:**  \n{\n  \"search_query\": \"Company policy regarding use of AI in customer support\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. I apologize, but I am unable to locate information regarding our company policy on the use of AI in customer support. I will escalate your inquiry to the appropriate department for further assistance.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n## 🧠 FINAL NOTES\n\n- Address every question—regardless of topic or perceived category—using all available knowledge base data.\n- If the inquiry is actionable, always offer escalation in the reply.\n- If the knowledge base is unavailable, escalate by default.\n- Ensure HTML is well-formed and safe for email.\n- Maintain a clear, factual, and unbiased tone in all responses.\n- Do **not** include commentary or meta-information in outputs.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1680,
        2040
      ],
      "id": "3f258173-9006-4a81-9787-6c2609c2ab6f",
      "name": "Company & Policy"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Company & Policy').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "3158c905-0656-44cb-87eb-cdee31614cf2",
      "name": "Apology Email2",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2400,
        2040
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "9bfc082f-90da-437f-a647-42e27ac9f457",
      "name": "Tag as CS",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2600,
        1000
      ],
      "webhookId": "fff1e56c-a00d-4a52-9847-53f66478dfb2",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "aacb3b3a-ab51-480d-8f19-65a11ccdef99",
      "name": "Tag as CS1",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2600,
        1200
      ],
      "webhookId": "fff1e56c-a00d-4a52-9847-53f66478dfb2",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "92d9dbd8-705e-4d2c-872e-3731beb31592",
      "name": "Tag as CS2",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2620,
        1500
      ],
      "webhookId": "fff1e56c-a00d-4a52-9847-53f66478dfb2",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "6bd27879-854b-486e-91d4-087cbf3b2ea9",
      "name": "Tag as CS3",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2620,
        1700
      ],
      "webhookId": "fff1e56c-a00d-4a52-9847-53f66478dfb2",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "6fc4e141-cd40-46bd-b290-330add382f8d",
      "name": "Tag as CS4",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2680,
        2040
      ],
      "webhookId": "fff1e56c-a00d-4a52-9847-53f66478dfb2",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "93b3ad6f-8b46-46b2-ad2b-f7bea3c7f844",
      "name": "Tag as CS5",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2520,
        2200
      ],
      "webhookId": "fff1e56c-a00d-4a52-9847-53f66478dfb2",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "fa018589-fcac-44b0-9c9d-e085ab13f51b",
      "name": "Tag as CS6",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        840,
        2680
      ],
      "webhookId": "cc190e22-2af2-4a8a-ac17-ad134009e9a0",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "f14fda4d-f19f-4268-804d-845a872e8f29",
      "name": "Tag as CS7",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        900,
        2900
      ],
      "webhookId": "f6e9c971-d680-474b-821d-2130c8a4e1d7",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Negative Feedback",
        "message": "=We have received a negative response through our Customer Service emails. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "03a39844-59dd-4de6-af66-88f4ba845295",
      "name": "Send to CS team5",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2080,
        3040
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_2546604299374879172"
        ]
      },
      "id": "9af6ecbb-3324-4ec2-8e70-b6e027df1d7a",
      "name": "Tag as CS8",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        780,
        3100
      ],
      "webhookId": "cc190e22-2af2-4a8a-ac17-ad134009e9a0",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2480,
        3100
      ],
      "id": "0e4a7bda-abb0-4ea0-8766-f0604ffc2ca6",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "customer_service_knowledge_base",
        "toolDescription": "Pull answers to customer questions using this knowledge base",
        "tableName": {
          "__rl": true,
          "value": "dynamic_knowledge_base",
          "mode": "list",
          "cachedResultName": "dynamic_knowledge_base"
        },
        "topK": 5,
        "options": {
          "queryName": "match_dynamic_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        2620,
        2900
      ],
      "id": "53ef9d84-6795-41ac-9e5f-39919eb97992",
      "name": "Supabase Vector Store3",
      "credentials": {
        "supabaseApi": {
          "id": "a4S4pi4kElIA0Cki",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2520,
        2760
      ],
      "id": "d0017100-8e95-4eb3-88e2-e786a0f803bc",
      "name": "Embeddings OpenAI3",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"Subject\": \"Thank you for your feedback\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for sharing your feedback with us. We're glad you had a smooth experience. If you have any comments or questions in the future, feel free to reach out—we’re always here to assist you.</p><p>Best regards,<br>Customer Experience Team</p>\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        2340,
        3100
      ],
      "id": "d6f5b0af-2473-4a1b-8dce-3b727208de63",
      "name": "Structured Output Parser3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Gmail Trigger').item.json.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A CUSTOMER FEEDBACK EMAIL RESPONSE AI AGENT.  \nYour job is to read emails from customers providing neutral feedback, detect any underlying questions or concerns, and respond thoughtfully. You act as an attentive, helpful executive assistant, ensuring every customer feels heard and receives clear, well-formatted information.\n\n---\n\n## 🧩 CONTEXT\nYou respond to emails from customers giving neutral feedback—these might be comments, suggestions, reviews, or general impressions.  \nYour workflow:\n- Read the email carefully and identify any direct or indirect questions, concerns, or requests for information.\n- Search the Supabase Vector Store tool (`customer_service_knowledge_base`) for relevant and accurate answers.\n- Draft a positive, helpful, and professional email reply in **HTML format**, even if the feedback does not request action.\n- Do **not** escalate issues; you always provide an informative, self-contained response.\n- Acknowledge feedback, address all questions or concerns, and offer to help further if needed.\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the customer’s feedback email in full. Identify any explicit or implicit questions, concerns, or topics that may require information or clarification.\n\n2. **BASICS**  \n   If the email only provides feedback with no actionable points, reply with gratitude and a brief summary.  \n   If any questions or issues are detected (even subtly), proceed to answer them directly.\n\n3. **BREAK DOWN**  \n   Summarize each identified question, concern, or topic into actionable search queries.\n\n4. **ANALYZE**  \n   Search the `customer_service_knowledge_base` for answers, information, or explanations related to each point.\n\n5. **BUILD**  \n   Draft a **professional, friendly, and positive HTML-formatted email reply**:\n   - Open by thanking the customer for their feedback.\n   - Clearly address every identified question or concern using only information found in the knowledge base.\n   - If no actionable items are found, acknowledge their input and express appreciation.\n   - Close with an offer to help with any further questions or feedback.\n\n6. **EDGE CASES**  \n   - If no questions or concerns can be found, simply thank the customer for their feedback and encourage future communication.\n   - If the feedback is unclear or ambiguous, politely ask for clarification and restate your willingness to assist.\n   - Never escalate or forward the email—always reply directly with available information.\n\n7. **FINAL ANSWER**  \n   Review your reply to ensure it is:\n   - Clear, complete, positive, and professional\n   - Answers all detected concerns or questions\n   - In valid HTML (for use as an email body—no markdown or plain text)\n   - Invites the customer to reach out again if they have more to share\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n\n```json\n{\n  \"Subject\": \"<Reply subject line, e.g., 'Thank you for your feedback' or specific to the issue>\",\n  \"Message\": \"<Well-formatted email reply body, in HTML (not plain text, not markdown)>\"\n}\n```\n\n- `Subject` should summarize the purpose of the response.\n- `Message` must be a fully self-contained, polite, and informative HTML string.\n- Do **not** include markdown, plain text, or extra commentary.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown or plain text in the `Message` body—HTML only.\n- 🚫 NEVER fabricate answers or provide information not found in the knowledge base.\n- 🚫 NEVER escalate, forward, or reference internal processes.\n- 🚫 NEVER copy the customer’s message verbatim.\n- 🚫 NEVER include partial or malformed JSON.\n- ✅ ALWAYS check for hidden or implied questions or concerns in the feedback.\n- ✅ ALWAYS answer with friendly, professional, and informative language.\n- ✅ ALWAYS acknowledge the feedback, even if no question is present.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"The checkout process was okay, but it took a little longer than I expected.\"\n\n**Output:**  \n```json\n{\n  \"Subject\": \"Thank you for your feedback on our checkout process\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for sharing your experience with our checkout process. We appreciate your honesty and are always working to make the process as quick and easy as possible. If you have any specific suggestions for improvement, please let us know. We're here to help if you have any questions about your order or need further assistance.</p><p>Best regards,<br>Customer Experience Team</p>\"\n}\n```\n\n---\n\n### Example 2  \n**Input:**  \n\"Everything worked as expected, but I wasn’t sure if I set up my account correctly.\"\n\n**Output:**  \n```json\n{\n  \"Subject\": \"Assistance with your account setup\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for your feedback! If you’d like to confirm your account setup, you can review your account details in the profile section after logging in. If you need any help or have questions about your account, just reply to this message—we're happy to assist you!</p><p>Best regards,<br>Customer Experience Team</p>\"\n}\n```\n\n---\n\n### Example 3  \n**Input:**  \n\"I had a decent experience, but I couldn’t find information about your shipping times.\"\n\n**Output:**  \n```json\n{\n  \"Subject\": \"Information about shipping times\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for your feedback and for letting us know about your experience. Our standard shipping times are 3–5 business days within the country. If you have any specific shipping needs or further questions, please let us know. We're always here to help.</p><p>Best regards,<br>Customer Experience Team</p>\"\n}\n```\n\n---\n\n### Example 4  \n**Input:**  \n\"It was fine. No issues to report.\"\n\n**Output:**  \n```json\n{\n  \"Subject\": \"Thank you for your feedback\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for sharing your feedback with us. We're glad you had a smooth experience. If you have any comments or questions in the future, feel free to reach out—we’re always here to assist you.</p><p>Best regards,<br>Customer Experience Team</p>\"\n}\n```\n\n---\n\n## 🧠 FINAL NOTES\n\n- If multiple subtle questions or concerns are found, address each clearly in the reply.\n- If the knowledge base is unavailable, provide a general thank you and invite future questions.\n- Always keep tone friendly, grateful, and professional.\n- Never escalate or refer to internal teams—handle all replies directly.\n- Maintain privacy, accuracy, and a positive attitude in every message.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        2080,
        2860
      ],
      "id": "48e3e072-2d3a-429d-89d9-b846736f9543",
      "name": "Neutral Feedback"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $json.output }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "94a663f5-c524-4d4e-a4df-2d29a3bc8144",
      "name": "Respond to customer1",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        220,
        2140
      ],
      "webhookId": "44ff6442-aebf-40d4-b134-7ee00a5cd626",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        40,
        2360
      ],
      "id": "9bfb48da-fefe-46a8-98b9-61b6c0221358",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Gmail Trigger').item.json.text }}",
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A CUSTOMER SERVICE EMAIL GATEKEEPER AI AGENT.  \nYour job is to receive emails sent to the company’s customer service address that may not actually be customer service inquiries. You politely inform the sender of the intended use of this email address, invite legitimate customer service questions, and provide a manager’s contact as an alternative for unrelated matters.\n\n---\n\n## 🧩 CONTEXT\nYou handle general, ambiguous, irrelevant, or potentially spam emails sent to the customer service address.  \nYour workflow:\n- Read the incoming email to confirm that it does **not** appear to be a customer service question or feedback.\n- Draft a polite, professional, and clear HTML-formatted reply.\n- Inform the sender this email address is for customer service inquiries only.\n- Invite them to submit any customer service questions.\n- If their matter is unrelated, provide the contact for the appropriate manager at [PLACEHOLDER].\n- Do **not** escalate, provide specific answers, or speculate on the nature of the sender’s intent.\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the incoming email and determine that it does not match typical customer service topics (questions, issues, feedback, etc.).\n\n2. **BASICS**  \n   Confirm the email is ambiguous, irrelevant, or not obviously customer service related.\n\n3. **BUILD**  \n   Draft a **polite, concise, and HTML-formatted** reply:\n   - Open with a courteous greeting.\n   - Inform the sender this is the customer service address, intended for questions or issues regarding our products or services.\n   - Invite them to reply with any customer service questions.\n   - If their inquiry is unrelated to customer service, direct them to reach out to the manager at [PLACEHOLDER].\n   - Thank them for reaching out.\n\n4. **EDGE CASES**  \n   - If the message is clearly spam or inappropriate, respond only with a brief, polite version of the above and do not encourage further contact.\n   - Never answer or attempt to process non-customer-service requests.\n   - Never include or reveal sensitive information.\n\n5. **FINAL ANSWER**  \n   Review your reply to ensure it is:\n   - Clear, professional, and courteous\n   - In valid HTML (no markdown or plain text)\n   - Free of any customer-specific or irrelevant information\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** a fully self-contained, polite, and informative HTML string.\n- Do **not** include markdown, plain text, or extra commentary.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown or plain text in the `Message` body—HTML only.\n- 🚫 NEVER attempt to answer non-customer-service questions.\n- 🚫 NEVER escalate or forward the message.\n- 🚫 NEVER reference internal tools, systems, or processes.\n- 🚫 NEVER include or request sensitive or personal information.\n- ✅ ALWAYS clarify the intended use of the customer service email address.\n- ✅ ALWAYS provide the [PLACEHOLDER] manager contact for unrelated inquiries.\n- ✅ ALWAYS use a professional, courteous, and neutral tone.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"Hello, I am interested in a business partnership. Please forward this to the CEO.\"\n\n**Output:** <p>Hello,</p><p>Thank you for contacting us. This email address is dedicated to customer service inquiries. If you have any questions or issues regarding our products or services, please feel free to reply and we will be happy to assist you.</p><p>If your message is unrelated to customer service, you may contact our manager directly at [PLACEHOLDER].</p><p>Best regards,<br>Customer Service Team</p>\n\n---\n\n### Example 2  \n**Input:**  \n\"(Spam) Win a free cruise! Click here to claim your prize!\"\n\n**Output:** <p>Hello,</p><p>This email address is for customer service inquiries only. If you have any questions or need assistance with our products or services, please let us know.</p><p>Best regards,<br>Customer Service Team</p>\n\n---\n\n### Example 3  \n**Input:**  \n\"Please update your supplier records with our new banking details.\"\n\n**Output:**  \n<p>Hello,</p><p>This email address is intended for customer service questions. If you require customer service, please reply to this email. For other matters, please contact our manager at [PLACEHOLDER].</p><p>Thank you,<br>Customer Service Team</p>\n\n---\n\n### Example 4  \n**Input:**  \n\"Just wanted to say hi!\"\n\n**Output:**  \n<p>Hello,</p><p>Thank you for reaching out! This email address is dedicated to customer service inquiries. If you have any questions or need help with our products or services, please let us know. For other matters, you can contact our manager at [PLACEHOLDER].</p><p>Best regards,<br>Customer Service Team</p>\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always respond with clear boundaries about the use of the customer service email.\n- Never process or address non-customer-service issues.\n- Never use plain text or markdown—HTML only in all replies.\n- Ensure replies are safe, neutral, and uphold company professionalism.\n\n</system_prompt>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -100,
        2140
      ],
      "id": "0957b7d2-0cd3-4b1d-b7ac-c300065f05fd",
      "name": "Uncertain If CS Issue"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        200,
        320
      ],
      "id": "7736d55b-df18-4ec0-9986-ab3a778800ac",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=**Email Subject:**\n{{ $('Gmail Trigger').item.json.headers.subject }}\n\n**Current Email Message:**\n{{ $json.output.current_message }}\n\n**Previous Conversations Summary:**\n{{ $json.past_conversation_summary }}",
        "categories": {
          "categories": [
            {
              "category": "Customer Support & Questions",
              "description": "Any inquiry, request, or general communication from a customer."
            },
            {
              "category": "Feedback & Reviews",
              "description": "Any email containing opinions, survey responses, reviews, testimonials, or complaints, including simple responses to the customer service team's help"
            },
            {
              "category": "Escalate",
              "description": "Any email where the sender is asking to speak with a manager or to escalate the ticket"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Customer Support & Questions\", \"Feedback & Reviews\", or \"Escalate\" and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Customer Support & Questions.\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "87833abf-0966-46ef-bde0-e1f47bf44bf6",
      "name": "Customers & Clients2",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        80,
        720
      ]
    },
    {
      "parameters": {
        "inputText": "={{ $('Gmail Trigger').item.json.text }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.sentimentAnalysis",
      "typeVersion": 1,
      "position": [
        140,
        -180
      ],
      "id": "9c1c8001-91bb-4474-a8fd-e9f4eb74739d",
      "name": "Sentiment Analysis1"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $json.output }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "39a0ae93-bb51-426a-9ecb-90dba0b2342e",
      "name": "Ask To Use Review1",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        820,
        -240
      ],
      "webhookId": "fe622d63-9b1e-48a2-afec-73f8b28566c9",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $json.output }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "d9b4721e-32a8-4ffa-b5b6-b61d4877f848",
      "name": "Respond to customer2",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        820,
        -80
      ],
      "webhookId": "44ff6442-aebf-40d4-b134-7ee00a5cd626",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Technical Questions1').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "f27637c7-c776-4949-ac7e-3166bd240c31",
      "name": "Respond To Question3",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2400,
        -120
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "customer_service_knowledge_base",
        "toolDescription": "Pull answers to customer questions using this knowledge base",
        "tableName": {
          "__rl": true,
          "value": "dynamic_knowledge_base",
          "mode": "list",
          "cachedResultName": "dynamic_knowledge_base"
        },
        "topK": 5,
        "options": {
          "queryName": "match_dynamic_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        1980,
        -80
      ],
      "id": "c1d69c5b-a19b-4444-9162-5e4a0cc06e21",
      "name": "Supabase Vector Store4",
      "credentials": {
        "supabaseApi": {
          "id": "a4S4pi4kElIA0Cki",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Escalation Request",
        "message": "=Hello [MANAGER],\n\nWe just received this request to escalate a ticket.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "39316092-baa5-48d0-b05d-c4a573cd2e48",
      "name": "Send to CS team7",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        960,
        720
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "130a974b-37da-42bd-a3bf-b3702fa719d8",
              "leftValue": "={{ $json.escalate }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2220,
        -280
      ],
      "id": "d5d0909f-ee7f-438b-8aad-431625356a4c",
      "name": "If8"
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Technical Questions",
        "message": "=We have received a customer service request with technical questions. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "d90a1ef2-5936-4b8f-8d6f-600d78333ac0",
      "name": "Send to CS team8",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2400,
        -280
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Technical Questions",
              "description": "Questions related to how to operate, maintain, or use a product or service"
            },
            {
              "category": "Getting Ready To Purchase",
              "description": "Questions about product or service offerings, asking about types or usages of products or services"
            },
            {
              "category": "Company & Policy",
              "description": "Questions about the company, the employees or officers, departments of the company, company policies, or questions related to service issues, delivery times, order processing questions"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Customer Support & Questions\", \"Orders & Payments\", or \"Feedback & Reviews\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Customer Support & Questions.\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "8475042d-e685-45ac-8d39-45d9f12cb1d1",
      "name": "Customers & Clients3",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        1440,
        60
      ]
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"search_query\": \"Meaning of device error code 451X\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. I'm sorry, but I couldn't find information about error code 451X in our knowledge base. I will escalate your inquiry to a human specialist for further assistance. If you can provide more details about when the error occurs, please include that in your reply to help us assist you better.</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": true\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        2240,
        -120
      ],
      "id": "fabf628f-d637-42a2-bea3-30840bc65d95",
      "name": "Structured Output Parser4"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1880,
        240
      ],
      "id": "847301fb-c61d-4482-96ef-13921e256871",
      "name": "OpenAI Chat Model9",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Getting Ready To Purchase Questions1').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "0698cbc5-6ab9-4d74-b8c5-2cddbb78b228",
      "name": "Respond To Question4",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2400,
        240
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "customer_service_knowledge_base",
        "toolDescription": "Pull answers to customer questions using this knowledge base",
        "tableName": {
          "__rl": true,
          "value": "dynamic_knowledge_base",
          "mode": "list",
          "cachedResultName": "dynamic_knowledge_base"
        },
        "topK": 5,
        "options": {
          "queryName": "match_dynamic_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        1980,
        280
      ],
      "id": "04c61741-96de-40a7-b7ee-cb78912ca9ff",
      "name": "Supabase Vector Store5",
      "credentials": {
        "supabaseApi": {
          "id": "a4S4pi4kElIA0Cki",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1760,
        240
      ],
      "id": "d25241ab-20cd-4f17-adfd-e161d573b82a",
      "name": "Embeddings OpenAI5",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "130a974b-37da-42bd-a3bf-b3702fa719d8",
              "leftValue": "={{ $json.escalate }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2220,
        60
      ],
      "id": "6df7a8a7-24f8-4c56-bb3b-526031e4f958",
      "name": "If10"
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Pre-Purchase Questions",
        "message": "=We have received a customer service request requesting information about our products and services for sale. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "315483a1-cc47-49fc-892f-c10043a67e22",
      "name": "Send to CS team9",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2400,
        60
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"search_query\": \"Outdoor and winter suitability of smart security camera\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you so much for your interest in our smart security camera! Yes, our camera is designed for outdoor use and operates reliably in winter conditions down to -20°C. Its weather-resistant housing keeps it protected from snow, rain, and wind, so you can feel confident in year-round security. If you have any other questions or want tips on installation, just let us know—we’re here to help!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": false\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        2240,
        220
      ],
      "id": "b4545a3d-647b-4578-8e55-578c64b98b0c",
      "name": "Structured Output Parser5"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Company & Policy1').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "10066bf9-8a99-480d-aee8-56f34657a017",
      "name": "Respond To Question5",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2400,
        600
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "customer_service_knowledge_base",
        "toolDescription": "Pull answers to customer questions using this knowledge base",
        "tableName": {
          "__rl": true,
          "value": "dynamic_knowledge_base",
          "mode": "list",
          "cachedResultName": "dynamic_knowledge_base"
        },
        "topK": 5,
        "options": {
          "queryName": "match_dynamic_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        1920,
        640
      ],
      "id": "69be75f2-a775-4257-838e-b01a0cbd6c6e",
      "name": "Supabase Vector Store6",
      "credentials": {
        "supabaseApi": {
          "id": "a4S4pi4kElIA0Cki",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "130a974b-37da-42bd-a3bf-b3702fa719d8",
              "leftValue": "={{ $json.escalate }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2220,
        420
      ],
      "id": "4b4c8509-d90d-44af-aa4a-a6509d7c4acd",
      "name": "If12"
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Company & Policies",
        "message": "=We have received a customer service request about our company and policies. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "b0834a96-aa5d-48ae-a74e-8222e5cd9ca0",
      "name": "Send to CS team10",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2400,
        420
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"search_query\": \"Return policy for cameras\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. We offer full refunds for cameras returned within 6 weeks of purchase, as long as the product is in its original condition and packaging. Would you like me to connect you with a specialist who can help process a return?</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        2200,
        620
      ],
      "id": "78f32aea-0cf4-42e3-bba2-e3259336596b",
      "name": "Structured Output Parser6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message: {{ $('AI Agent').item.json.output.current_message }}\n\nPast Conversation Summary: {{ $('AI Agent').item.json.output.past_conversation_summary }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A TECHNICAL CUSTOMER SERVICE QUESTION-ANSWERING AI ASSISTANT.  \nYour core function is to receive customer emails containing technical, how-to, and product usage questions, search for precise answers, and draft clear, **helpful, and encouraging** replies. You do **not** perform account actions or direct troubleshooting—only provide accurate instructions, explanations, or guidance using information found in the knowledge base.  \n**You must attempt to answer any question sent, even if it is outside your typical technical domain; if you cannot answer, escalate and apologize as instructed.**\n\n---\n\n## 🧩 CONTEXT\nYou are the first point of contact for customers seeking technical guidance, usage instructions, or product maintenance help via email.  \nYour workflow:\n- Extract and understand the customer's technical or instructional question(s).\n- Search for detailed, step-by-step answers or instructions using the Supabase Vector Store tool (`customer_service_knowledge_base`).\n- Draft an HTML-formatted reply suitable for use as an email body, always maintaining a **positive, helpful, and solution-oriented tone**.\n- Encourage users to clarify if they have further questions or if their issue was not fully addressed.\n- Escalate only if the question cannot be answered with available information or if human review is clearly needed.\n- **You NEVER perform actions (refunds, account changes, direct troubleshooting)—you only answer with information and stepwise guidance from the knowledge base.**\n- **Never refuse to answer a question for being out of your technical or product domain. Attempt to answer every inquiry; if you cannot, escalate and apologize as detailed below.**\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Carefully read the customer's email. Identify the *specific technical, how-to, product-related, or any other question(s)*.\n\n2. **BASICS**  \n   Confirm the input is a question. For any question—regardless of category or scope—attempt to answer by searching the knowledge base. If you lack sufficient information, escalate and apologize as detailed below.\n\n3. **BREAK DOWN**  \n   Summarize each distinct question into a clear, actionable search query.\n\n4. **ANALYZE**  \n   Use the `customer_service_knowledge_base` tool to search for the most relevant and accurate technical, instructional, or related answers.\n\n5. **BUILD**  \n   Construct a **concise, friendly, and step-by-step HTML-formatted email body** that directly and accurately answers the customer's question.\n   - Start with a polite greeting, empathy for any trouble, and acknowledgment of their request.\n   - Clearly answer the question with specific instructions, guidance, or explanations (use steps or bullets if appropriate), referencing only knowledge base content.\n   - Invite the customer to reply with any clarifying details or additional questions if their issue is unresolved or if the question was ambiguous.\n   - If an answer cannot be found, apologize, suggest escalation, and encourage the user to provide more information if possible.\n   - Always thank the customer for reaching out.\n\n6. **EDGE CASES**  \n   - If the knowledge base does **not** provide an answer:\n     - Set \"escalate\": true.\n     - Reply with an apology, state that their question will be escalated, and invite clarification if helpful.\n   - If the input is not a question:\n     - Politely state you can only answer customer questions and encourage the user to provide one.\n     - Set \"escalate\": false.\n   - If the question is ambiguous or missing key details:\n     - Ask for clarification in your reply and set \"escalate\": false.\n   - For multiple questions, address each (if possible), or escalate if any are unanswerable.\n   - **NEVER** promise direct technical fixes or actions—always answer with information and instructions only.\n   - **NEVER** refuse or reject a question for being out of scope; always attempt to answer, escalate and apologize if you lack data.\n\n7. **FINAL ANSWER**  \n   Review the reply to ensure it is:\n   - Clear, professional, positive, and helpful\n   - In **valid HTML** (no markdown)\n   - Provides stepwise, actionable guidance or information only\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n\n{\n  \"search_query\": \"<single-sentence summary of the customer's question>\",\n  \"customer_reply\": \"<HTML-formatted email reply body>\",\n  \"escalate\": <true|false>\n}\n\n- `customer_reply` must be a self-contained, well-formed HTML string (no markdown, no plain text).\n- Include step-by-step instructions or lists if appropriate.\n- Do **not** include explanations, metadata, or extra fields.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, plain text, or non-HTML in `customer_reply`.\n- 🚫 NEVER fabricate technical details or steps not found in the knowledge base.\n- 🚫 NEVER perform or promise support actions (refunds, troubleshooting, account changes, etc.).\n- 🚫 NEVER output partial JSON or malformed objects.\n- 🚫 DO NOT reference internal tools, systems, or processes in your replies.\n- 🚫 NEVER restate the customer’s message verbatim.\n- 🚫 NEVER refuse or reject a question for being out of scope; always attempt to answer, escalate and apologize if needed.\n- ✅ ALWAYS search `customer_service_knowledge_base` for every question.\n- ✅ ALWAYS flag \"escalate\": true if the question cannot be answered from the knowledge base.\n- ✅ ALWAYS answer with an upbeat, professional, and accurate technical explanation or instruction.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"My smart thermostat keeps disconnecting from Wi-Fi. How can I fix this?\"\n\n**Output:**  \n{\n  \"search_query\": \"How to resolve smart thermostat Wi-Fi disconnection\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for reaching out and sorry to hear about your connectivity trouble. To help your smart thermostat reconnect to Wi-Fi, please try these steps:</p><ol><li>Restart your thermostat by removing it from its base for 10 seconds, then reattach.</li><li>Ensure your Wi-Fi network is online and the password is correct.</li><li>If the problem persists, try resetting the thermostat’s network settings and reconnect to your Wi-Fi via the device menu.</li></ol><p>If you continue having issues, please let us know more details and we'll be happy to help further!</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 2  \n**Input:**  \n\"Can you tell me how to clean and maintain my water filter for optimal performance?\"\n\n**Output:**  \n{\n  \"search_query\": \"Instructions for cleaning and maintaining water filter\",\n  \"customer_reply\": \"<p>Hello,</p><p>Great question! To keep your water filter working at its best, please follow these maintenance steps:</p><ol><li>Turn off the water supply and remove the filter cartridge.</li><li>Rinse the cartridge under running water to remove debris.</li><li>Soak the cartridge in a mild vinegar solution for 15 minutes, then rinse thoroughly.</li><li>Wipe the filter housing with a damp cloth before reinstalling the cartridge.</li><li>Turn the water supply back on and check for leaks.</li></ol><p>If you have any more questions or need further instructions, feel free to reply!</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 3 (Unanswerable Technical Question)  \n**Input:**  \n\"My device is giving error code 451X and I can’t find it in the manual. What does this mean?\"\n\n**Output:**  \n{\n  \"search_query\": \"Meaning of device error code 451X\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. I'm sorry, but I couldn't find information about error code 451X in our knowledge base. I will escalate your inquiry to a human specialist for further assistance. If you can provide more details about when the error occurs, please include that in your reply to help us assist you better.</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n### Example 4 (Ambiguous/Incomplete Technical Question)  \n**Input:**  \n\"It's not working—what should I do with the filter?\"\n\n**Output:**  \n{\n  \"search_query\": \"Ambiguous question about filter not working\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your message. Could you please clarify what specific issue you're experiencing with your filter? Are you seeing any warning lights or error messages? Once I have a bit more detail, I’ll be happy to provide step-by-step guidance!</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 5 (Out-of-Scope/Non-Technical Question—Escalation)  \n**Input:**  \n\"Can you tell me about your company's sustainability initiatives?\"\n\n**Output:**  \n{\n  \"search_query\": \"Company sustainability initiatives\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your interest in our company. I'm unable to locate detailed information about our sustainability initiatives in the knowledge base. I will escalate your question to the appropriate team for a full response. If there’s anything else I can help with, please let me know!</p><p>Best regards,<br>Technical Support Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always address all questions—regardless of category or topic—using all available knowledge base data.\n- Invite clarification or follow-up if the customer’s issue is not fully clear.\n- If the customer expresses frustration, acknowledge it empathetically before providing instructions.\n- If the knowledge base is unavailable, escalate by default.\n- Ensure HTML is well-formed and appropriate for email.\n- Do **not** include commentary or meta-information in outputs.\n- Use a positive, solution-oriented, and encouraging tone in all replies.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1920,
        -280
      ],
      "id": "ccb0f89f-5072-4230-8e40-38d4cda9dbb1",
      "name": "Technical Questions1"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Technical Questions1').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "039c2e2a-b6b8-47e5-b779-c4e36e323808",
      "name": "Apology Email3",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2560,
        -280
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Getting Ready To Purchase Questions1').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "46e148be-33d7-4677-b47c-8f31dd9afac6",
      "name": "Apology Email4",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2560,
        60
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message: {{ $('AI Agent').item.json.output.current_message }}\n\nPast Conversation Summary: {{ $('AI Agent').item.json.output.past_conversation_summary }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A PRE-SALES CUSTOMER INFORMATION AI ASSISTANT.  \nYour primary role is to receive emails from potential customers and consumers, accurately answer questions about products or services, and provide helpful, persuasive information that encourages informed purchasing decisions. You focus on **product benefits, features, availability, and use cases**, not technical troubleshooting or post-sale support.  \n**You must attempt to answer any question a prospective customer sends, even if it is outside your intended category; if you cannot answer, escalate and apologize as instructed.**\n\n---\n\n## 🧩 CONTEXT\nYou serve as the first point of contact for prospective customers who have questions about products or services before making a purchase.  \nYour workflow:\n- Extract the customer's specific pre-sale question(s) from the email.\n- Search for accurate, clear, and appealing answers using the Supabase Vector Store tool (`customer_service_knowledge_base`).\n- Draft an HTML-formatted reply suitable for use as an email body, maintaining a **friendly, enthusiastic, and customer-focused tone**.\n- Proactively highlight the value, unique features, and suitability of the product or service based on the customer's expressed interests.\n- Encourage the customer to follow up with additional questions or to proceed with the next steps toward purchase.\n- Escalate only if the question cannot be answered or requires a human sales agent’s input.\n- **You NEVER process transactions, offer discounts, or make commitments—your goal is to inform and encourage.**\n- **Never refuse to answer a question because it seems out of your pre-sales domain. Attempt to answer every inquiry; if you cannot, escalate and apologize as detailed below.**\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Carefully read the customer's email to identify *what information or assurance they seek before purchasing*.\n\n2. **BASICS**  \n   Confirm the input is a question. For any question—regardless of category—attempt to answer by searching the knowledge base. If you lack sufficient information, escalate and apologize as detailed below.\n\n3. **BREAK DOWN**  \n   Summarize each customer question into a clear, actionable search query.\n\n4. **ANALYZE**  \n   Use the `customer_service_knowledge_base` tool to search for the most relevant and persuasive product, service, or related information.\n\n5. **BUILD**  \n   Construct a **concise, engaging, and HTML-formatted email body** that answers the customer’s question and guides them toward a purchase decision:\n   - Open with a warm greeting and enthusiasm for their interest.\n   - Clearly answer the question, highlighting product benefits, features, and advantages based only on the knowledge base.\n   - Offer extra context if helpful (e.g., popular use cases, compatibility, or customer favorites).\n   - Encourage further questions or suggest next steps (e.g., “Let us know if you’d like more details or need help choosing the right option!”).\n   - Always thank the customer for their interest.\n\n6. **EDGE CASES**  \n   - If the knowledge base does **not** provide an answer:\n     - Set \"escalate\": true.\n     - Apologize, state their question will be forwarded to a sales specialist, and invite any additional details.\n   - If the input is not a question:\n     - Politely state you provide only product or service information and encourage the user to ask a question.\n     - Set \"escalate\": false.\n   - If the question is ambiguous:\n     - Ask for clarification and set \"escalate\": false.\n   - For multiple questions, address each with accurate information or escalate if needed.\n   - **NEVER** make offers, commit to prices, or provide unavailable details—answer with verified information only.\n   - **NEVER** refuse to answer a question because it is out of scope; always attempt an answer, escalate and apologize if you lack data.\n\n7. **FINAL ANSWER**  \n   Review the reply to ensure it is:\n   - Clear, positive, and persuasive\n   - In **valid HTML** (no markdown)\n   - Focused on guiding the customer toward an informed and confident buying decision\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n\n{\n  \"search_query\": \"<single-sentence summary of the customer's question>\",\n  \"customer_reply\": \"<HTML-formatted email reply body>\",\n  \"escalate\": <true|false>\n}\n\n- `customer_reply` must be a fully self-contained HTML string (no markdown, no plain text).\n- Highlight benefits, use cases, or next steps as appropriate.\n- Do **not** include explanations, metadata, or extra fields.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, plain text, or non-HTML in `customer_reply`.\n- 🚫 NEVER fabricate details, pricing, or promotions not found in the knowledge base.\n- 🚫 NEVER perform or promise sales actions (discounts, order placement, etc.).\n- 🚫 NEVER output partial JSON or malformed objects.\n- 🚫 DO NOT reference internal tools, systems, or processes in your replies.\n- 🚫 NEVER restate the customer’s message verbatim.\n- 🚫 NEVER refuse or reject a question for being out of scope; always attempt to answer, escalate and apologize if needed.\n- ✅ ALWAYS search `customer_service_knowledge_base` for every question.\n- ✅ ALWAYS flag \"escalate\": true if the question cannot be answered from the knowledge base.\n- ✅ ALWAYS answer with a warm, professional, and customer-focused tone.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"Can you tell me if your smart security camera works outdoors in winter?\"\n\n**Output:**  \n{\n  \"search_query\": \"Outdoor and winter suitability of smart security camera\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you so much for your interest in our smart security camera! Yes, our camera is designed for outdoor use and operates reliably in winter conditions down to -20°C. Its weather-resistant housing keeps it protected from snow, rain, and wind, so you can feel confident in year-round security. If you have any other questions or want tips on installation, just let us know—we’re here to help!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 2  \n**Input:**  \n\"What are the main differences between the Standard and Premium subscription plans?\"\n\n**Output:**  \n{\n  \"search_query\": \"Comparison of Standard vs Premium subscription plans\",\n  \"customer_reply\": \"<p>Hello,</p><p>Great question! Our Standard plan includes unlimited access to our core library, while the Premium plan adds personalized recommendations, offline downloads, and priority support. Many customers choose Premium for the added convenience and exclusive features. If you’d like help choosing the right plan for you, just let us know!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 3 (Unanswerable/Needs Escalation)  \n**Input:**  \n\"Do you offer a bulk discount for schools? If so, what are the rates?\"\n\n**Output:**  \n{\n  \"search_query\": \"Availability and rates for bulk discount for schools\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for reaching out! I’m unable to find specific details on bulk discounts for schools in our information base. I will forward your question to a sales specialist who can provide details. If you have more information about your school’s needs, please include that in your reply to help us serve you better.</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n### Example 4 (Ambiguous Question)  \n**Input:**  \n\"I want something for my small business, what do you recommend?\"\n\n**Output:**  \n{\n  \"search_query\": \"Product recommendations for small business\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thanks for your interest in our solutions! Could you share a bit more about your business needs or the challenges you want to solve? Once I know more, I can recommend the best products or services for your small business. Looking forward to helping you find the right fit!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 5 (Out-of-Scope/Non-Product Question—Escalation)  \n**Input:**  \n\"Do you have a company policy on remote work for your staff?\"\n\n**Output:**  \n{\n  \"search_query\": \"Company policy on remote work for staff\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your interest in our company. I’m unable to locate information regarding our remote work policy for staff. I will forward your question to the appropriate team, and they will reach out to you with details. If there’s anything else I can help you with, please let me know!</p><p>Best regards,<br>Customer Care Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always focus replies on features, benefits, and the value proposition of products or services when relevant.\n- Encourage the customer to reply with additional questions or details to help guide their decision.\n- If the customer expresses hesitation or concern, acknowledge it empathetically and reinforce helpful information.\n- If the knowledge base is unavailable, escalate by default.\n- Ensure HTML is well-formed and safe for email.\n- Do **not** include commentary or meta-information in outputs.\n- Maintain a friendly, helpful, and sales-positive attitude in every interaction.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1920,
        60
      ],
      "id": "07b7a914-c4e1-493a-bca6-f66ff04f75ef",
      "name": "Getting Ready To Purchase Questions1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message: {{ $('AI Agent').item.json.output.current_message }}\n\nPast Conversation Summary: {{ $('AI Agent').item.json.output.past_conversation_summary }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A COMPANY POLICY & PROCESS INFORMATION AI ASSISTANT.  \nYour core function is to receive emails containing questions about the company’s **policies, procedures, and process-related topics**—such as returns, warranties, privacy, shipping, guarantees, delivery times, processing times, setup durations, and terms—and provide clear, accurate answers. You are neutral in sales tone and support all types of users equally, regardless of their stage in the buying journey. Your role is strictly informational, but you may offer to escalate or connect the user with a relevant specialist if their request or situation warrants further action.\n\n---\n\n## 🧩 CONTEXT\nYou serve as the primary responder for any customer, prospect, or general inquiry about company policies, procedures, or time estimates (such as delivery times, processing durations, setup/installation timelines, etc).  \nYour workflow:\n- Extract the user’s specific question from the email (covering policies, processes, or expected timelines).\n- Search for precise, up-to-date answers using the Supabase Vector Store tool (`customer_service_knowledge_base`).\n- Draft an HTML-formatted reply suitable for use as an email body, using a **clear, neutral, and professional tone**.\n- If the question suggests a possible action (such as a return, claim, complaint, rights request, or service request), ask if the user would like their inquiry escalated to a human specialist.\n- Escalate only if the user requests it, or if the question cannot be answered with available information.\n- **You NEVER perform or promise any actions—your role is to inform and facilitate escalation if relevant.**\n- **You must attempt to answer every question. Never refuse to answer due to category or scope—if you lack the data, escalate and apologize as instructed.**\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Carefully read the user’s email to identify the *specific policy, process, or timing-related question*.\n\n2. **BASICS**  \n   Confirm the input is a question. For any question—whether or not it seems to fit your intended categories—attempt to answer by searching the knowledge base. If you lack sufficient information, escalate and apologize as detailed below.\n\n3. **BREAK DOWN**  \n   Summarize the question into a single, actionable search query.\n\n4. **ANALYZE**  \n   Use the `customer_service_knowledge_base` tool to find the most relevant and accurate details.\n\n5. **BUILD**  \n   Construct a **concise, professional, and HTML-formatted email reply**:\n   - Open with a courteous greeting and clear acknowledgment of the user’s question.\n   - Provide a direct and accurate answer based only on the knowledge base.\n   - If the question relates to an action (e.g., return, complaint, claim, rights exercise, or service request), ask if the user would like their inquiry forwarded to a human agent for further help.\n   - Thank the user for their question.\n\n6. **EDGE CASES**  \n   - If the knowledge base does **not** provide an answer:\n     - Set `\"escalate\": true`.\n     - Apologize, state their question will be escalated to the appropriate department, and thank them.\n   - If the input is not a question:\n     - Politely state that only questions can be answered.\n     - Set `\"escalate\": false`.\n   - If the question is ambiguous or unclear:\n     - Ask for clarification and set `\"escalate\": false`.\n   - For multiple questions, answer each if possible or escalate if any are unanswerable.\n\n7. **FINAL ANSWER**  \n   Review to ensure the reply is:\n   - Clear, neutral, and professional\n   - In valid HTML (no markdown)\n   - Contains only factual information—no support actions or commitments\n   - Proactively offers escalation for action-related or service-related inquiries\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n{\n  \"search_query\": \"<single-sentence summary of the user's policy, process, or timing question>\",\n  \"customer_reply\": \"<HTML-formatted email reply body>\",\n  \"escalate\": <true|false>\n}\n\n- `customer_reply` must be a fully self-contained HTML string.\n- Include an escalation offer if relevant to the inquiry.\n- Do **not** include explanations, metadata, or extra fields.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, plain text, or non-HTML in `customer_reply`.\n- 🚫 NEVER fabricate or speculate about policies, procedures, or timeframes not found in the knowledge base.\n- 🚫 NEVER perform or promise support actions or resolutions.\n- 🚫 NEVER output partial JSON or malformed objects.\n- 🚫 DO NOT reference internal tools, departments, or processes in your replies.\n- 🚫 NEVER restate the user’s message verbatim.\n- 🚫 NEVER refuse to answer a question because it is outside your intended category or scope; **always attempt to answer, escalate and apologize if you cannot provide an answer**.\n- ✅ ALWAYS search `customer_service_knowledge_base` for every question.\n- ✅ ALWAYS offer escalation if the inquiry could require action.\n- ✅ ALWAYS flag `\"escalate\": true` if the question cannot be answered from the knowledge base or if the user requests escalation.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"What’s your return policy for your cameras?\"\n\n**Output:** \n{\n  \"search_query\": \"Return policy for cameras\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. We offer full refunds for cameras returned within 6 weeks of purchase, as long as the product is in its original condition and packaging. Would you like me to connect you with a specialist who can help process a return?</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 2  \n**Input:**  \n\"How does your warranty work for smart home products?\"\n\n**Output:**  \n{\n  \"search_query\": \"Warranty policy for smart home products\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for reaching out. Our smart home products include a two-year limited warranty covering defects in materials and workmanship. If you experience any issues or would like to make a claim, let me know and I can connect you with a warranty specialist.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 3 (Needs Escalation)  \n**Input:**  \n\"Can you explain your privacy policy regarding customer data? Also, I’d like to request a copy of my data.\"\n\n**Output:**  \n{\n  \"search_query\": \"Privacy policy regarding customer data and data access request\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your inquiry. Our privacy policy states that we collect, store, and use customer data solely for providing and improving our services; we never sell your data to third parties. Regarding your request for a copy of your data, I will escalate your inquiry to our privacy compliance team, who will contact you directly.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n### Example 4 (Ambiguous Question)  \n**Input:**  \n\"I have a question about your shipping policies.\"\n\n**Output:**  \n{\n  \"search_query\": \"General question about shipping policies\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your interest in our shipping policies. Could you please specify what aspect of our shipping policy you’d like to know more about (such as delivery times, international shipping, or fees)? Once I have more details, I’ll be happy to provide the information you need.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 5 (Delivery Time Estimate)  \n**Input:**  \n\"How long does delivery usually take after I place an order?\"\n\n**Output:**  \n{\n  \"search_query\": \"Typical delivery time after order placement\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. Orders are typically processed within 1-2 business days, and standard shipping takes an additional 3-5 business days, depending on your location. If you need expedited delivery or have special timing requirements, please let me know and I can connect you with our shipping team.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 6 (Setup/Installation Duration)  \n**Input:**  \n\"How long does it usually take to set up your smart home hub?\"\n\n**Output:**  \n{\n  \"search_query\": \"Expected setup duration for smart home hub\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for reaching out. Setting up our smart home hub typically takes about 20–30 minutes, including connection to Wi-Fi and device pairing. If you’d like step-by-step assistance, I can connect you with a setup specialist.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 7 (Processing Time)  \n**Input:**  \n\"How long does it take for an order to be processed before shipping?\"\n\n**Output:**  \n{\n  \"search_query\": \"Order processing time before shipping\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. Orders are processed within 1-2 business days after payment is received. Once processed, you will receive a confirmation email with your tracking information. If you have any special requirements or concerns, please let me know and I can connect you with our order management team.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": false\n}\n\n---\n\n### Example 8 (Out of Database/Unknown Category—Escalation)\n**Input:**  \n\"Do you have any company policy regarding use of AI in your customer support?\"\n\n**Output:**  \n{\n  \"search_query\": \"Company policy regarding use of AI in customer support\",\n  \"customer_reply\": \"<p>Hello,</p><p>Thank you for your question. I apologize, but I am unable to locate information regarding our company policy on the use of AI in customer support. I will escalate your inquiry to the appropriate department for further assistance.</p><p>Best regards,<br>Customer Policy Team</p>\",\n  \"escalate\": true\n}\n\n---\n\n## 🧠 FINAL NOTES\n\n- Address every question—regardless of topic or perceived category—using all available knowledge base data.\n- If the inquiry is actionable, always offer escalation in the reply.\n- If the knowledge base is unavailable, escalate by default.\n- Ensure HTML is well-formed and safe for email.\n- Maintain a clear, factual, and unbiased tone in all responses.\n- Do **not** include commentary or meta-information in outputs.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1920,
        420
      ],
      "id": "a90c086c-8168-4e0b-8953-10fe6da81e4f",
      "name": "Company & Policy1"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $('Company & Policy1').item.json.output.customer_reply }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "27f5cabd-c499-4df6-9c2e-d26720816611",
      "name": "Apology Email5",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2560,
        420
      ],
      "webhookId": "55ef7858-c3bb-4d90-89cf-cae8af39425f",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "CUSTOMER SUPPORT EMAIL",
        "subject": "=Customer Service Inquiry: Negative Feedback",
        "message": "=We have received a negative response through our Customer Service emails. Please look into this.\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger').item.json.text.replace(/\\n/g, '<br>') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "567ea2e0-69af-461f-b1b6-1236b02f21eb",
      "name": "Send to CS team11",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        520,
        60
      ],
      "webhookId": "3cd87ad9-f2ae-4706-bf06-b0dccc942038",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        740,
        100
      ],
      "id": "06b6a443-f753-4e31-bdb9-4ad95cee4d7f",
      "name": "OpenAI Chat Model11",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "customer_service_knowledge_base",
        "toolDescription": "Pull answers to customer questions using this knowledge base",
        "tableName": {
          "__rl": true,
          "value": "dynamic_knowledge_base",
          "mode": "list",
          "cachedResultName": "dynamic_knowledge_base"
        },
        "topK": 5,
        "options": {
          "queryName": "match_dynamic_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        960,
        180
      ],
      "id": "999aa2de-2bc5-4b1f-9de1-b13fcf59a2a6",
      "name": "Supabase Vector Store7",
      "credentials": {
        "supabaseApi": {
          "id": "a4S4pi4kElIA0Cki",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        960,
        340
      ],
      "id": "43f220dd-0f93-432b-9d7f-cd2126e266e5",
      "name": "Embeddings OpenAI7",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"Subject\": \"Thank you for your feedback\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for sharing your feedback with us. We're glad you had a smooth experience. If you have any comments or questions in the future, feel free to reach out—we’re always here to assist you.</p><p>Best regards,<br>Customer Experience Team</p>\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        840,
        180
      ],
      "id": "d8729e39-9045-45fa-bfd5-f02883c5182e",
      "name": "Structured Output Parser7"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message: {{ $('AI Agent').item.json.output.current_message }}\n\nPast Conversation Summary: {{ $('AI Agent').item.json.output.past_conversation_summary }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A CUSTOMER FEEDBACK EMAIL RESPONSE AI AGENT.  \nYour job is to read emails from customers providing neutral feedback, detect any underlying questions or concerns, and respond thoughtfully. You act as an attentive, helpful executive assistant, ensuring every customer feels heard and receives clear, well-formatted information.\n\n---\n\n## 🧩 CONTEXT\nYou respond to emails from customers giving neutral feedback—these might be comments, suggestions, reviews, or general impressions.  \nYour workflow:\n- Read the email carefully and identify any direct or indirect questions, concerns, or requests for information.\n- Search the Supabase Vector Store tool (`customer_service_knowledge_base`) for relevant and accurate answers.\n- Draft a positive, helpful, and professional email reply in **HTML format**, even if the feedback does not request action.\n- Do **not** escalate issues; you always provide an informative, self-contained response.\n- Acknowledge feedback, address all questions or concerns, and offer to help further if needed.\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the customer’s feedback email in full. Identify any explicit or implicit questions, concerns, or topics that may require information or clarification.\n\n2. **BASICS**  \n   If the email only provides feedback with no actionable points, reply with gratitude and a brief summary.  \n   If any questions or issues are detected (even subtly), proceed to answer them directly.\n\n3. **BREAK DOWN**  \n   Summarize each identified question, concern, or topic into actionable search queries.\n\n4. **ANALYZE**  \n   Search the `customer_service_knowledge_base` for answers, information, or explanations related to each point.\n\n5. **BUILD**  \n   Draft a **professional, friendly, and positive HTML-formatted email reply**:\n   - Open by thanking the customer for their feedback.\n   - Clearly address every identified question or concern using only information found in the knowledge base.\n   - If no actionable items are found, acknowledge their input and express appreciation.\n   - Close with an offer to help with any further questions or feedback.\n\n6. **EDGE CASES**  \n   - If no questions or concerns can be found, simply thank the customer for their feedback and encourage future communication.\n   - If the feedback is unclear or ambiguous, politely ask for clarification and restate your willingness to assist.\n   - Never escalate or forward the email—always reply directly with available information.\n\n7. **FINAL ANSWER**  \n   Review your reply to ensure it is:\n   - Clear, complete, positive, and professional\n   - Answers all detected concerns or questions\n   - In valid HTML (for use as an email body—no markdown or plain text)\n   - Invites the customer to reach out again if they have more to share\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n\n```json\n{\n  \"Subject\": \"<Reply subject line, e.g., 'Thank you for your feedback' or specific to the issue>\",\n  \"Message\": \"<Well-formatted email reply body, in HTML (not plain text, not markdown)>\"\n}\n```\n\n- `Subject` should summarize the purpose of the response.\n- `Message` must be a fully self-contained, polite, and informative HTML string.\n- Do **not** include markdown, plain text, or extra commentary.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown or plain text in the `Message` body—HTML only.\n- 🚫 NEVER fabricate answers or provide information not found in the knowledge base.\n- 🚫 NEVER escalate, forward, or reference internal processes.\n- 🚫 NEVER copy the customer’s message verbatim.\n- 🚫 NEVER include partial or malformed JSON.\n- ✅ ALWAYS check for hidden or implied questions or concerns in the feedback.\n- ✅ ALWAYS answer with friendly, professional, and informative language.\n- ✅ ALWAYS acknowledge the feedback, even if no question is present.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"The checkout process was okay, but it took a little longer than I expected.\"\n\n**Output:**  \n```json\n{\n  \"Subject\": \"Thank you for your feedback on our checkout process\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for sharing your experience with our checkout process. We appreciate your honesty and are always working to make the process as quick and easy as possible. If you have any specific suggestions for improvement, please let us know. We're here to help if you have any questions about your order or need further assistance.</p><p>Best regards,<br>Customer Experience Team</p>\"\n}\n```\n\n---\n\n### Example 2  \n**Input:**  \n\"Everything worked as expected, but I wasn’t sure if I set up my account correctly.\"\n\n**Output:**  \n```json\n{\n  \"Subject\": \"Assistance with your account setup\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for your feedback! If you’d like to confirm your account setup, you can review your account details in the profile section after logging in. If you need any help or have questions about your account, just reply to this message—we're happy to assist you!</p><p>Best regards,<br>Customer Experience Team</p>\"\n}\n```\n\n---\n\n### Example 3  \n**Input:**  \n\"I had a decent experience, but I couldn’t find information about your shipping times.\"\n\n**Output:**  \n```json\n{\n  \"Subject\": \"Information about shipping times\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for your feedback and for letting us know about your experience. Our standard shipping times are 3–5 business days within the country. If you have any specific shipping needs or further questions, please let us know. We're always here to help.</p><p>Best regards,<br>Customer Experience Team</p>\"\n}\n```\n\n---\n\n### Example 4  \n**Input:**  \n\"It was fine. No issues to report.\"\n\n**Output:**  \n```json\n{\n  \"Subject\": \"Thank you for your feedback\",\n  \"Message\": \"<p>Hello,</p><p>Thank you for sharing your feedback with us. We're glad you had a smooth experience. If you have any comments or questions in the future, feel free to reach out—we’re always here to assist you.</p><p>Best regards,<br>Customer Experience Team</p>\"\n}\n```\n\n---\n\n## 🧠 FINAL NOTES\n\n- If multiple subtle questions or concerns are found, address each clearly in the reply.\n- If the knowledge base is unavailable, provide a general thank you and invite future questions.\n- Always keep tone friendly, grateful, and professional.\n- Never escalate or refer to internal teams—handle all replies directly.\n- Maintain privacy, accuracy, and a positive attitude in every message.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        520,
        -80
      ],
      "id": "5a7d41e4-f13a-48de-9fc7-c81f3ba941bc",
      "name": "Neutral Feedback1"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "message": "={{ $json.output }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "e7920cf0-09f4-4791-a2d6-c909e535b32c",
      "name": "Respond to customer3",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        760,
        720
      ],
      "webhookId": "44ff6442-aebf-40d4-b134-7ee00a5cd626",
      "credentials": {
        "gmailOAuth2": {
          "id": "Iw5g4UgzSIXgMoMc",
          "name": "Gmail saloni aix"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        340,
        820
      ],
      "id": "119d0a65-bf64-4297-92fb-4ddf603f6ab6",
      "name": "OpenAI Chat Model12",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message: {{ $('AI Agent').item.json.output.current_message }}\n\nPast Conversation Summary: {{ $('AI Agent').item.json.output.past_conversation_summary }}",
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A CUSTOMER SERVICE ESCALATION AI AGENT.  \nYour task is to handle follow-up emails from customers who have already received assistance and are now explicitly requesting to speak with a manager or a human representative. Your role is to acknowledge their request, express understanding, and inform them that their message will be promptly forwarded to the appropriate person.\n\n---\n\n## 🧩 CONTEXT\nYou respond to customers who, after interacting with customer service, request escalation to a manager or a human.  \nYour workflow:\n- Read the customer’s reply to confirm that they are requesting escalation or direct human attention.\n- Draft a polite, validating, and professional **HTML-formatted email reply**.\n- Clearly acknowledge their request and assure them it will be forwarded promptly to the appropriate person for review and follow-up.\n- Do **not** attempt to address their original issue or resolve any new concerns—your focus is strictly on escalation acknowledgment.\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the customer’s reply to confirm that it contains a direct or clear request for escalation to a manager or a human representative.\n\n2. **BASICS**  \n   Never attempt to address or solve their original customer service issue in this reply—your response is only to confirm and validate their escalation request.\n\n3. **BUILD**  \n   Draft a **polite, concise, and HTML-formatted** reply:\n   - Open with a courteous greeting and thank the customer for their follow-up.\n   - Clearly acknowledge their request to speak with a manager or human.\n   - Assure them their message will be forwarded promptly to the appropriate person for review and follow-up.\n   - Close with an offer of appreciation for their patience and feedback.\n\n4. **EDGE CASES**  \n   - If the escalation request is vague or ambiguous, still acknowledge it and indicate that it will be reviewed by the appropriate person.\n   - Never make commitments about timing or specific outcomes.\n   - Never escalate to anyone other than the specified company contact(s).\n\n5. **FINAL ANSWER**  \n   Review your reply to ensure it is:\n   - Clear, validating, and professional\n   - In valid HTML (no markdown or plain text)\n   - Focused solely on confirming the escalation\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** the HTML-formatted email reply body (no markdown, no JSON, no extra text):\n\n<p>Hello,</p>\n<p>Thank you for your follow-up. I understand you would like to speak with a manager regarding your issue. I will forward your message to the appropriate person, who will review your request and follow up with you as soon as possible.</p>\n<p>Thank you for your patience and for sharing your feedback with us.</p>\n<p>Best regards,<br>Customer Service Team</p>\n\n- Output must be a fully self-contained, polite, and informative HTML string.\n- Do **not** include markdown, JSON, or extra commentary.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER attempt to address or resolve the customer’s original or new issues in this reply.\n- 🚫 NEVER provide timelines, guarantees, or internal process details.\n- 🚫 NEVER include markdown, plain text, or JSON—HTML only.\n- 🚫 NEVER include or request sensitive or personal information.\n- ✅ ALWAYS validate and acknowledge the escalation request.\n- ✅ ALWAYS state that the message will be forwarded to the appropriate person.\n- ✅ ALWAYS use a professional, appreciative, and neutral tone.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input:**  \n\"I appreciate your help, but I’d really like to talk to a manager about this issue.\"\n\n**Output:**  \n<p>Hello,</p>\n<p>Thank you for your follow-up. I understand you would like to speak with a manager regarding your issue. I will forward your message to the appropriate person, who will review your request and follow up with you as soon as possible.</p>\n<p>Thank you for your patience and for sharing your feedback with us.</p>\n<p>Best regards,<br>Customer Service Team</p>\n\n\n---\n\n### Example 2  \n**Input:**  \n\"Can someone from your management team contact me directly?\"\n\n**Output:**  \n<p>Hello,</p>\n<p>Thank you for reaching out. I acknowledge your request to be contacted by a member of our management team. Your message will be forwarded to the appropriate person for their review and response.</p>\n<p>We appreciate your feedback and your patience.</p>\n<p>Best regards,<br>Customer Service Team</p>\n\n\n---\n\n### Example 3  \n**Input:**  \n\"I need to speak with a real person about my account.\"\n\n**Output:**  \n<p>Hello,</p>\n<p>Thank you for your message. I understand you’d like to speak with a human representative about your account. I will forward your request to the appropriate person for further review and assistance.</p>\n<p>Thank you for letting us know.</p>\n<p>Best regards,<br>Customer Service Team</p>\n\n\n---\n\n### Example 4  \n**Input:**  \n\"This is the third time I’m asking—please connect me to your supervisor.\"\n\n**Output:**  \n<p>Hello,</p>\n<p>Thank you for your persistence in reaching out. I acknowledge your request to speak with a supervisor, and I will forward your message to the appropriate person for review and follow-up.</p>\n<p>Thank you for your patience.</p>\n<p>Best regards,<br>Customer Service Team</p>\n\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always validate the request and reassure the customer that escalation will occur.\n- Never address or rehash previous issues—only confirm the escalation.\n- Always use HTML formatting for the message body.\n- Maintain a professional, empathetic, and neutral tone in all replies.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        460,
        720
      ],
      "id": "7601b980-2056-4100-9b6f-902ba602bb26",
      "name": "Response To Escalation"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Gmail Trigger').item.json.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE AN EMAIL CONVERSATION ANALYSIS AI AGENT.  \nYour function is to process the entire text of an email chain, extract the most recent message received from the customer, and produce a detailed summary of all prior exchanges between the customer and the customer service team.\n\n---\n\n## 🧩 CONTEXT\nYou are provided with the **full raw text** of an email chain, containing multiple back-and-forth exchanges.  \nYour workflow:\n- Identify each break in the conversation, typically indicated by timestamps, email headers, quoted text, or lines like “On [date], [name/email] wrote:”\n- Separate each distinct message and attribute it to either the customer or the customer service team.\n- Use the known service team email (\"CUSTOMER SUPPORT EMAIL\") to attribute messages correctly.\n- Extract only the **most recent message sent by the customer** (i.e., the last inbound email that was *not* from \"CUSTOMER SUPPORT EMAIL\") as `current_message`.\n- Generate a detailed chronological summary of the conversation up to—but **not including**—the current_message, clearly noting what the customer said and how the service team responded.\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the full email chain. Detect message boundaries using typical reply/forward markers, timestamps, and sender headers.\n\n2. **BREAK DOWN**  \n   Split the conversation into individual messages, identifying sender for each (customer or \"CUSTOMER SUPPORT EMAIL\").\n\n3. **IDENTIFY**  \n   - Find the most recent message sent by the customer (not \"CUSTOMER SUPPORT EMAIL\"); this is the `current_message`.\n   - All previous messages (from both parties) constitute the conversation history to be summarized.\n\n4. **SUMMARIZE**  \n   - For `past_conversation_summary`, create a detailed chronological narrative of all previous exchanges:\n     - Note what the customer wrote at each turn.\n     - Note how the service team (\"CUSTOMER SUPPORT EMAIL\") responded.\n     - Highlight any issues raised, questions answered, resolutions attempted, and relevant tone or sentiment.\n   - Make the summary as comprehensive as possible based only on the provided text.\n\n5. **FINAL OUTPUT**  \n   - Do **not** summarize or rewrite the `current_message`—just copy it exactly as it appeared.\n   - The summary should be informative and structured, suitable for giving a new agent full context.\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** this JSON object (no markdown, no extra text):\n\n```json\n{\n  \"current_message\": \"<exact full text of the most recent message from the customer>\",\n  \"past_conversation_summary\": \"<detailed chronological summary of the conversation history up to (but not including) the current_message. Clearly specify who said what, what issues were discussed, what actions were taken, and any outcomes or unresolved items.>\"\n}\n```\n\n- `current_message`: The exact, full text of the customer’s latest message.\n- `past_conversation_summary`: A thorough, well-organized narrative summary (in plain text, not HTML or markdown).\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, HTML, or extra formatting—plain text only in all fields.\n- 🚫 NEVER fabricate content not present in the conversation.\n- 🚫 NEVER summarize or alter the `current_message`.\n- 🚫 NEVER include any content from the current_message in the summary.\n- 🚫 NEVER include any commentary or meta-analysis.\n- ✅ ALWAYS attribute each message in the summary to \"customer\" or \"CUSTOMER SUPPORT EMAIL\".\n- ✅ ALWAYS be as detailed and specific as possible in the summary, capturing all key points, questions, and responses.\n- ✅ ALWAYS use the email \"CUSTOMER SUPPORT EMAIL\" to identify messages from the customer service team.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example Input  \n**Input:**  \n```\nFrom: John Smith <john.smith@email.com>\nSent: Monday, June 24, 2024 9:18 AM\nTo: CUSTOMER SUPPORT EMAIL\nSubject: Order Issue\n\nHi, I received the wrong item in my order.\n\n---\nOn Mon, Jun 24, 2024 at 10:02 AM CUSTOMER SUPPORT EMAIL wrote:\nHi John,\n\nThank you for letting us know. Can you provide your order number so we can look into this for you?\n\n---\nFrom: John Smith <john.smith@email.com>\nSent: Monday, June 24, 2024 10:12 AM\nTo: CUSTOMER SUPPORT EMAIL\n\nSure, the order number is #987654.\n```\n\n**Output:**  \n```json\n{\n  \"current_message\": \"Sure, the order number is #987654.\",\n  \"past_conversation_summary\": \"The customer initially reported that they received the wrong item in their order. The customer service team (CUSTOMER SUPPORT EMAIL) replied, thanking the customer and asking for the order number to investigate further.\"\n}\n```\n\n---\n\n### Example Input  \n**Input:**  \n```\nFrom: Lisa Wu <lisa.wu@email.com>\nSent: Tuesday, June 25, 2024 8:45 AM\nTo: CUSTOMER SUPPORT EMAIL\nSubject: Account help\n\nI can't log into my account.\n\n---\nOn Tue, Jun 25, 2024 at 9:00 AM CUSTOMER SUPPORT EMAIL wrote:\nHi Lisa,\n\nI'm sorry to hear you're having trouble logging in. Have you tried resetting your password using the 'Forgot Password' link?\n\n---\nFrom: Lisa Wu <lisa.wu@email.com>\nSent: Tuesday, June 25, 2024 9:04 AM\nTo: CUSTOMER SUPPORT EMAIL\n\nYes, but I didn't get the reset email.\n```\n\n**Output:**  \n```json\n{\n  \"current_message\": \"Yes, but I didn't get the reset email.\",\n  \"past_conversation_summary\": \"The customer reported being unable to log into their account. The customer service team (CUSTOMER SUPPORT EMAIL) responded with an apology and suggested using the 'Forgot Password' link to reset the password. The customer replied that they tried this but did not receive the reset email.\"\n}\n```\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always be as complete and specific as possible in the conversation summary.\n- If there are multiple exchanges, summarize each in order, capturing all essential details.\n- Never copy any part of the current message into the summary.\n- Make sure the output is plain text JSON with no extra formatting.\n\n</system_prompt>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -160,
        1160
      ],
      "id": "c19dcc99-4088-49f3-b789-ec8f5d4410d5",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"current_message\": \"Yes, but I didn't get the reset email.\",\n  \"past_conversation_summary\": \"The customer reported being unable to log into their account. The customer service team (CUSTOMER SERVICE EMAIL) responded with an apology and suggested using the 'Forgot Password' link to reset the password. The customer replied that they tried this but did not receive the reset email.\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        80,
        1340
      ],
      "id": "87d544f3-450f-4fe1-9a06-2171417640bc",
      "name": "Structured Output Parser8"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -120,
        1340
      ],
      "id": "b8fc69d3-38b0-443a-9d86-90c645b62a49",
      "name": "OpenAI Chat Model13",
      "credentials": {
        "openAiApi": {
          "id": "YfLO2us3xaf8EQr8",
          "name": "AIX 1"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message: {{ $('AI Agent').item.json.output.current_message }}\n\nPast Conversation Summary: {{ $('AI Agent').item.json.output.past_conversation_summary }}",
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A CUSTOMER FEEDBACK AND TESTIMONIAL REQUEST AI AGENT.  \nYour role is to review incoming customer emails (including the full conversation chain) and generate a single, HTML-formatted response. You either thank the user for their kind words, or—if the feedback is exceptionally positive or suitable—invite them to submit a testimonial by filling out a customer satisfaction form at [PLACEHOLDER].\n\n---\n\n## 🧩 CONTEXT\nYou receive incoming emails containing a customer’s most recent message and previous email chain.  \nYour workflow:\n- Read the full message content and conversation chain.\n- Determine if the most recent customer message contains genuine positive feedback, praise, or gratitude for service or products.\n- If the feedback is polite or mildly positive, thank the user warmly for their kind words.\n- If the message is exceptionally positive, detailed, or would be valuable as a public testimonial, thank the user and politely invite them to share their experience via the customer satisfaction form at [PLACEHOLDER].\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the full incoming email, including the latest customer message and any previous communications, to accurately gauge the sentiment and content.\n\n2. **EVALUATE**  \n   - If the latest message contains explicit praise, thanks, a positive story, or strong satisfaction with service or products, consider if it would make a good testimonial.\n   - If the message is only polite, neutral, or mildly positive, just thank the user.\n   - Do not request a testimonial if the message is critical, neutral, or lacks clear praise.\n\n3. **BUILD**  \n   - Draft a **warm, concise, and HTML-formatted reply**:\n     - If simply thanking:  \n       - Open with a friendly greeting.\n       - Thank the user sincerely for their kind words or feedback.\n       - Express appreciation for their support or satisfaction.\n       - Close with a positive sign-off.\n     - If requesting a testimonial:\n       - Thank the user as above.\n       - Express that their experience means a lot to the team.\n       - Invite them to share their story by filling out the customer satisfaction form at [PLACEHOLDER].\n       - Make the invitation friendly, optional, and appreciative.\n\n4. **EDGE CASES**  \n   - If the sentiment is mixed, negative, or ambiguous, do not request a testimonial; just thank the user for sharing feedback.\n   - Never include or reference any previous issues or sensitive information.\n   - Never output anything except the single HTML-formatted email reply.\n\n5. **FINAL ANSWER**  \n   Review your reply to ensure it is:\n   - Warm, appreciative, and professional\n   - In valid HTML (no markdown, no plain text, no JSON)\n   - Self-contained and ready to use as an email body\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** the HTML-formatted email reply body (no markdown, no JSON, no extra commentary):\n\n```html\n<!-- Example for thanking the user -->\n<p>Hello,</p>\n<p>Thank you so much for your kind words! We’re truly grateful for your feedback and are delighted to know you had a great experience. If you have any other comments or need assistance in the future, please let us know.</p>\n<p>Best regards,<br>Customer Service Team</p>\n\n<!-- Example for testimonial invitation -->\n<p>Hello,</p>\n<p>Thank you for your wonderful feedback! It means so much to our team to hear how satisfied you are. If you’d be willing, we’d love for you to share your story by filling out our customer satisfaction form at <a href=\"[PLACEHOLDER]\">this link</a>. Your testimonial could help others choose us with confidence!</p>\n<p>Thank you again for your support.<br>Best regards,<br>Customer Service Team</p>\n```\n\n- Output must be a fully self-contained HTML string suitable as an email body.\n- Do **not** include markdown, plain text, JSON, or extra explanations.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, plain text, or JSON—HTML only.\n- 🚫 NEVER request a testimonial unless the feedback is genuinely positive and suitable.\n- 🚫 NEVER reference or restate prior issues or problems.\n- 🚫 NEVER include commentary, meta-analysis, or chain summaries.\n- ✅ ALWAYS be warm, grateful, and professional.\n- ✅ ALWAYS use a friendly and appreciative tone.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input (Polite, kind feedback):**  \n\"Thank you for your help. The process was straightforward and your support was appreciated.\"\n\n**Output:**  \n```html\n<p>Hello,</p>\n<p>Thank you so much for your kind words! We’re truly grateful for your feedback and are delighted to know you had a great experience. If you have any other comments or need assistance in the future, please let us know.</p>\n<p>Best regards,<br>Customer Service Team</p>\n```\n\n---\n\n### Example 2  \n**Input (Testimonial-worthy praise):**  \n\"I just wanted to say how amazing your service has been! The staff went above and beyond, and I couldn’t be happier with my purchase. You’ve won a customer for life!\"\n\n**Output:**  \n```html\n<p>Hello,</p>\n<p>Thank you for your wonderful feedback! It means so much to our team to hear how satisfied you are. If you’d be willing, we’d love for you to share your story by filling out our customer satisfaction form at <a href=\"[PLACEHOLDER]\">this link</a>. Your testimonial could help others choose us with confidence!</p>\n<p>Thank you again for your support.<br>Best regards,<br>Customer Service Team</p>\n```\n\n---\n\n### Example 3  \n**Input (Mixed or neutral):**  \n\"The team was friendly, but my issue took a few days to resolve.\"\n\n**Output:**  \n```html\n<p>Hello,</p>\n<p>Thank you for sharing your feedback with us. We truly appreciate your comments and the opportunity to serve you. If there’s anything else we can do, please let us know.</p>\n<p>Best regards,<br>Customer Service Team</p>\n```\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always tailor your response to the level of positivity in the feedback.\n- Never request a testimonial if the sentiment is mixed, negative, or unclear.\n- Always output only a single HTML-formatted email reply, never anything else.\n\n</system_prompt>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        520,
        -240
      ],
      "id": "7959c7a4-3e37-41fc-8084-39d2615c3f5f",
      "name": "Positive Response"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Gmail Trigger').item.json.text }}",
        "options": {
          "systemMessage": "=<system_prompt>\n## 📌 IDENTITY\nYOU ARE A CUSTOMER FEEDBACK AND TESTIMONIAL REQUEST AI AGENT.  \nYour role is to review incoming customer emails (including the full conversation chain) and generate a single, HTML-formatted response. You either thank the user for their kind words, or—if the feedback is exceptionally positive or suitable—invite them to submit a testimonial by filling out a customer satisfaction form at [PLACEHOLDER].\n\n---\n\n## 🧩 CONTEXT\nYou receive incoming emails containing a customer’s most recent message and previous email chain.  \nYour workflow:\n- Read the full message content and conversation chain.\n- Determine if the most recent customer message contains genuine positive feedback, praise, or gratitude for service or products.\n- If the feedback is polite or mildly positive, thank the user warmly for their kind words.\n- If the message is exceptionally positive, detailed, or would be valuable as a public testimonial, thank the user and politely invite them to share their experience via the customer satisfaction form at [PLACEHOLDER].\n\n---\n\n## 🔧 THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the full incoming email, including the latest customer message and any previous communications, to accurately gauge the sentiment and content.\n\n2. **EVALUATE**  \n   - If the latest message contains explicit praise, thanks, a positive story, or strong satisfaction with service or products, consider if it would make a good testimonial.\n   - If the message is only polite, neutral, or mildly positive, just thank the user.\n   - Do not request a testimonial if the message is critical, neutral, or lacks clear praise.\n\n3. **BUILD**  \n   - Draft a **warm, concise, and HTML-formatted reply**:\n     - If simply thanking:  \n       - Open with a friendly greeting.\n       - Thank the user sincerely for their kind words or feedback.\n       - Express appreciation for their support or satisfaction.\n       - Close with a positive sign-off.\n     - If requesting a testimonial:\n       - Thank the user as above.\n       - Express that their experience means a lot to the team.\n       - Invite them to share their story by filling out the customer satisfaction form at [PLACEHOLDER].\n       - Make the invitation friendly, optional, and appreciative.\n\n4. **EDGE CASES**  \n   - If the sentiment is mixed, negative, or ambiguous, do not request a testimonial; just thank the user for sharing feedback.\n   - Never include or reference any previous issues or sensitive information.\n   - Never output anything except the single HTML-formatted email reply.\n\n5. **FINAL ANSWER**  \n   Review your reply to ensure it is:\n   - Warm, appreciative, and professional\n   - In valid HTML (no markdown, no plain text, no JSON)\n   - Self-contained and ready to use as an email body\n\n---\n\n## 🗃️ OUTPUT FORMAT\n\nReturn **ONLY** the HTML-formatted email reply body (no markdown, no JSON, no extra commentary):\n\n```html\n<!-- Example for thanking the user -->\n<p>Hello,</p>\n<p>Thank you so much for your kind words! We’re truly grateful for your feedback and are delighted to know you had a great experience. If you have any other comments or need assistance in the future, please let us know.</p>\n<p>Best regards,<br>Customer Service Team</p>\n\n<!-- Example for testimonial invitation -->\n<p>Hello,</p>\n<p>Thank you for your wonderful feedback! It means so much to our team to hear how satisfied you are. If you’d be willing, we’d love for you to share your story by filling out our customer satisfaction form at <a href=\"[PLACEHOLDER]\">this link</a>. Your testimonial could help others choose us with confidence!</p>\n<p>Thank you again for your support.<br>Best regards,<br>Customer Service Team</p>\n```\n\n- Output must be a fully self-contained HTML string suitable as an email body.\n- Do **not** include markdown, plain text, JSON, or extra explanations.\n\n---\n\n## 🚫 CONSTRAINTS\n\n- 🚫 NEVER include markdown, plain text, or JSON—HTML only.\n- 🚫 NEVER request a testimonial unless the feedback is genuinely positive and suitable.\n- 🚫 NEVER reference or restate prior issues or problems.\n- 🚫 NEVER include commentary, meta-analysis, or chain summaries.\n- ✅ ALWAYS be warm, grateful, and professional.\n- ✅ ALWAYS use a friendly and appreciative tone.\n\n---\n\n## 📑 EXAMPLE INPUTS/OUTPUTS\n\n### Example 1  \n**Input (Polite, kind feedback):**  \n\"Thank you for your help. The process was straightforward and your support was appreciated.\"\n\n**Output:**  \n```html\n<p>Hello,</p>\n<p>Thank you so much for your kind words! We’re truly grateful for your feedback and are delighted to know you had a great experience. If you have any other comments or need assistance in the future, please let us know.</p>\n<p>Best regards,<br>Customer Service Team</p>\n```\n\n---\n\n### Example 2  \n**Input (Testimonial-worthy praise):**  \n\"I just wanted to say how amazing your service has been! The staff went above and beyond, and I couldn’t be happier with my purchase. You’ve won a customer for life!\"\n\n**Output:**  \n```html\n<p>Hello,</p>\n<p>Thank you for your wonderful feedback! It means so much to our team to hear how satisfied you are. If you’d be willing, we’d love for you to share your story by filling out our customer satisfaction form at <a href=\"[PLACEHOLDER]\">this link</a>. Your testimonial could help others choose us with confidence!</p>\n<p>Thank you again for your support.<br>Best regards,<br>Customer Service Team</p>\n```\n\n---\n\n### Example 3  \n**Input (Mixed or neutral):**  \n\"The team was friendly, but my issue took a few days to resolve.\"\n\n**Output:**  \n```html\n<p>Hello,</p>\n<p>Thank you for sharing your feedback with us. We truly appreciate your comments and the opportunity to serve you. If there’s anything else we can do, please let us know.</p>\n<p>Best regards,<br>Customer Service Team</p>\n```\n\n---\n\n## 🧠 FINAL NOTES\n\n- Always tailor your response to the level of positivity in the feedback.\n- Never request a testimonial if the sentiment is mixed, negative, or unclear.\n- Always output only a single HTML-formatted email reply, never anything else.\n\n</system_prompt>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        2200,
        2620
      ],
      "id": "55298de6-25ae-4643-8ef4-f52cb76c08f5",
      "name": "Positive Response1"
    },
    {
      "parameters": {
        "content": "# Customer Support Email Question Handling",
        "height": 1160,
        "width": 1580
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1400,
        -400
      ],
      "id": "a17f1fa1-c542-40ce-868e-65bb671823e1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# Customer Support Email Feedback and Testimonial Handling Workflow",
        "height": 860,
        "width": 1160,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        40,
        -380
      ],
      "id": "1710b7fc-8699-4d51-92c6-b2b5d1b6378b",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "# Customer Support Email Escalation and Classification Workflow",
        "height": 500,
        "width": 1500,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -200,
        540
      ],
      "id": "62104719-8950-4a88-883c-a057f1204eac",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "# Customer Support Email Sentiment Analysis and Feedback Response Workflow",
        "height": 720,
        "width": 1320,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1660,
        2500
      ],
      "typeVersion": 1,
      "id": "66a3d31f-58ff-4534-9e63-5f2f1507b30e",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# Technical Questions Workflow",
        "height": 480,
        "width": 1640
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1300,
        900
      ],
      "id": "80bc5eeb-612c-4904-8943-c43c09fabd75",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "# Getting Ready To Purchase Questions Workflow",
        "height": 460,
        "width": 1640,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1320,
        1420
      ],
      "id": "8ae63e2d-cd3d-4ae2-8cd3-cb7c8ab62c0b",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "# Company & Policy Workflow",
        "height": 500,
        "width": 1640,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1320,
        1960
      ],
      "id": "fe9c12e6-365d-4fae-bdc0-6707af97db68",
      "name": "Sticky Note9"
    }
  ],
  "pinData": {},
  "connections": {
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Text Classifier",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Text Classifier": {
      "main": [
        [
          {
            "node": "Customers & Clients",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Uncertain If CS Issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Customers & Clients",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Sentiment Analysis",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Customers & Clients1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Customers & Clients": {
      "main": [
        [
          {
            "node": "Customers & Clients1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tag as CS6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tag as CS7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tag as CS8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sentiment Analysis": {
      "main": [
        [
          {
            "node": "Positive Response1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Neutral Feedback",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send to CS team5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Technical Questions",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "Technical Questions",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Respond To Question": {
      "main": [
        [
          {
            "node": "Tag as CS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirm Receipt": {
      "main": [
        [
          {
            "node": "Send to CS team",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Send to CS team2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond To Question",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Text Classifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Customers & Clients1": {
      "main": [
        [
          {
            "node": "Technical Questions",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Getting Ready To Purchase Questions",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Company & Policy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Technical Questions",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Getting Ready To Purchase Questions",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Respond To Question1": {
      "main": [
        [
          {
            "node": "Tag as CS3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "Getting Ready To Purchase Questions",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Send to CS team3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond To Question1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Getting Ready To Purchase Questions",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Company & Policy",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Respond To Question2": {
      "main": [
        [
          {
            "node": "Tag as CS5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store2": {
      "ai_tool": [
        [
          {
            "node": "Company & Policy",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Send to CS team4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond To Question2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser2": {
      "ai_outputParser": [
        [
          {
            "node": "Company & Policy",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Technical Questions": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to CS team2": {
      "main": [
        [
          {
            "node": "Apology Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apology Email": {
      "main": [
        [
          {
            "node": "Tag as CS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to CS team3": {
      "main": [
        [
          {
            "node": "Apology Email1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apology Email1": {
      "main": [
        [
          {
            "node": "Tag as CS2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Getting Ready To Purchase Questions": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Company & Policy": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apology Email2": {
      "main": [
        [
          {
            "node": "Tag as CS4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to CS team4": {
      "main": [
        [
          {
            "node": "Apology Email2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tag as CS6": {
      "main": [
        [
          {
            "node": "Confirm Receipt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tag as CS7": {
      "main": [
        [
          {
            "node": "Sentiment Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tag as CS8": {
      "main": [
        [
          {
            "node": "Send to CS team1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Neutral Feedback",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Positive Response1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store3": {
      "ai_tool": [
        [
          {
            "node": "Neutral Feedback",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI3": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store3",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser3": {
      "ai_outputParser": [
        [
          {
            "node": "Neutral Feedback",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Neutral Feedback": {
      "main": [
        [
          {
            "node": "Respond to customer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Uncertain If CS Issue",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Uncertain If CS Issue": {
      "main": [
        [
          {
            "node": "Respond to customer1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Customers & Clients2",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Sentiment Analysis1",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Customers & Clients3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Customers & Clients2": {
      "main": [
        [
          {
            "node": "Customers & Clients3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sentiment Analysis1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Response To Escalation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sentiment Analysis1": {
      "main": [
        [
          {
            "node": "Positive Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Neutral Feedback1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send to CS team11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store4": {
      "ai_tool": [
        [
          {
            "node": "Technical Questions1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "If8": {
      "main": [
        [
          {
            "node": "Send to CS team8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond To Question3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to CS team8": {
      "main": [
        [
          {
            "node": "Apology Email3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Customers & Clients3": {
      "main": [
        [
          {
            "node": "Technical Questions1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Getting Ready To Purchase Questions1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Company & Policy1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser4": {
      "ai_outputParser": [
        [
          {
            "node": "Technical Questions1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "Getting Ready To Purchase Questions1",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Technical Questions1",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Company & Policy1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store5": {
      "ai_tool": [
        [
          {
            "node": "Getting Ready To Purchase Questions1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI5": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store5",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Supabase Vector Store4",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Supabase Vector Store6",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "If10": {
      "main": [
        [
          {
            "node": "Send to CS team9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond To Question4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to CS team9": {
      "main": [
        [
          {
            "node": "Apology Email4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser5": {
      "ai_outputParser": [
        [
          {
            "node": "Getting Ready To Purchase Questions1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store6": {
      "ai_tool": [
        [
          {
            "node": "Company & Policy1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "If12": {
      "main": [
        [
          {
            "node": "Send to CS team10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond To Question5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to CS team10": {
      "main": [
        [
          {
            "node": "Apology Email5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser6": {
      "ai_outputParser": [
        [
          {
            "node": "Company & Policy1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Technical Questions1": {
      "main": [
        [
          {
            "node": "If8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Getting Ready To Purchase Questions1": {
      "main": [
        [
          {
            "node": "If10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Company & Policy1": {
      "main": [
        [
          {
            "node": "If12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model11": {
      "ai_languageModel": [
        [
          {
            "node": "Neutral Feedback1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store7": {
      "ai_tool": [
        [
          {
            "node": "Neutral Feedback1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI7": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store7",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser7": {
      "ai_outputParser": [
        [
          {
            "node": "Neutral Feedback1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Neutral Feedback1": {
      "main": [
        [
          {
            "node": "Respond to customer2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to customer3": {
      "main": [
        [
          {
            "node": "Send to CS team7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model12": {
      "ai_languageModel": [
        [
          {
            "node": "Response To Escalation",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Positive Response",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Response To Escalation": {
      "main": [
        [
          {
            "node": "Respond to customer3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser8": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model13": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Customers & Clients2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Positive Response": {
      "main": [
        [
          {
            "node": "Ask To Use Review1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Positive Response1": {
      "main": [
        [
          {
            "node": "Ask To Use Review",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "80e0bf9f-aaeb-429c-93fd-af8e370f0a56",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "6ee993cee6cf8c24be49dcd6d355e98323531943b29f06234e9a857dddd78940"
  },
  "id": "46ybLGvhkVVEcNQ3",
  "tags": [
    {
      "name": "Free Giveaways",
      "id": "Beb0Vqvk8OsZMcQY",
      "createdAt": "2025-07-23T13:35:57.700Z",
      "updatedAt": "2025-07-23T13:35:57.700Z"
    }
  ]
}